/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/codemirror-6-prerelease@1.1.0/dist/codemirror.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var w3cKeyname=require("w3c-keyname"),extendingChars=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u180b-\u180d\u18a9\u200c\u200d]/;try{extendingChars=new RegExp("\\p{Grapheme_Extend}","u")}catch(t){}function isExtendingChar(t){var e=t.charCodeAt(0);return e>=768&&(e>=56320&&e<57344||extendingChars.test(t))}var wordChar,nonASCIISingleCaseWordChar=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;try{wordChar=new RegExp("[\\p{Alphabetic}_]","u")}catch(t){}function isWordCharBasic(t){return wordChar?wordChar.test(t):/\w/.test(t)||t>""&&(t.toUpperCase()!=t.toLowerCase()||nonASCIISingleCaseWordChar.test(t))}function isWordChar(t,e){return e?!!(e.source.indexOf("\\w")>-1&&isWordCharBasic(t))||e.test(t):isWordCharBasic(t)}function charType(t,e){return/\s/.test(t)?1:isWordChar(t,e)?0:2}function countColumn(t,e,n){for(var i=0;i<t.length;i++){var r=t.charCodeAt(i);9==r?e+=n-e%n:(r<768||!isExtendingChar(t.charAt(i)))&&e++}return e}function findColumn(t,e,n,i){for(var r=0;r<t.length;r++){var o=t.charCodeAt(r);if(!(o>=768&&isExtendingChar(t.charAt(r)))){if(e>=n)return{offset:r,leftOver:0};e+=9==o?i-e%i:1}}return{offset:t.length,leftOver:n-e}}var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function __extends(t,e){function n(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var BASE_LEAF=512,MAX_LEAF=BASE_LEAF<<1,TARGET_BRANCH_SHIFT=3,Text=function(){function t(){}return t.prototype.lineAt=function(t){if(t<0||t>this.length)throw new RangeError("Invalid position "+t+" in document of length "+this.length);for(var e=0;e<lineCache.length;e+=2)if(lineCache[e]==this){var n=lineCache[e+1];if(n.start<=t&&n.end>=t)return n}return cacheLine(this,this.lineInner(t,!1,1,0).finish(this))},t.prototype.line=function(t){if(t<1||t>this.lines)throw new RangeError("Invalid line number ${n} in ${this.lines}-line document");for(var e=0;e<lineCache.length;e+=2)if(lineCache[e]==this){var n=lineCache[e+1];if(n.number==t)return n}return cacheLine(this,this.lineInner(t,!0,1,0).finish(this))},t.prototype.replace=function(t,e,n){if(0==n.length)throw new RangeError("An inserted range must have at least one line");return this.replaceInner(t,e,n,textLength(n))},t.prototype.sliceLines=function(t,e){return void 0===e&&(e=this.length),this.sliceTo(t,e,[""])},t.prototype.slice=function(t,e,n){return joinLines(this.sliceLines(t,e),n)},t.prototype.eq=function(t){return this==t||eqContent(this,t)},t.prototype.iter=function(t){return void 0===t&&(t=1),new RawTextCursor(this,t)},t.prototype.iterRange=function(t,e){return void 0===e&&(e=this.length),new PartialTextCursor(this,t,e)},t.prototype.iterLines=function(t){return void 0===t&&(t=0),new LineCursor(this,t)},t.prototype.toString=function(){return this.slice(0,this.length)},t.of=function(t,e){if("string"==typeof t)t=splitLines(t,e);else if(0==t.length)throw new RangeError("A document must have at least one line");var n=textLength(t);return n<MAX_LEAF?new TextLeaf(t,n):TextNode.from(TextLeaf.split(t,[]),n)},t}(),lineCache=[],lineCachePos=-2,lineCacheSize=12;function cacheLine(t,e){return lineCache[lineCachePos=(lineCachePos+2)%lineCacheSize]=t,lineCache[lineCachePos+1]=e,e}function splitLines(t,e){return void 0===e&&(e=DEFAULT_SPLIT),t.split(e)}function joinLines(t,e){return void 0===e&&(e="\n"),t.join(e)}var DEFAULT_SPLIT=/\r\n?|\n/,TextLeaf=function(t){function e(e,n){void 0===n&&(n=textLength(e));var i=t.call(this)||this;return i.text=e,i.length=n,i}return __extends(e,t),Object.defineProperty(e.prototype,"lines",{get:function(){return this.text.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return null},enumerable:!0,configurable:!0}),e.prototype.replaceInner=function(t,e,n,i){return Text.of(appendText(this.text,appendText(n,sliceText(this.text,0,t)),e))},e.prototype.sliceTo=function(t,e,n){return void 0===e&&(e=this.length),appendText(this.text,n,t,e)},e.prototype.lineInner=function(t,e,n,i){for(var r=0;;r++){var o=this.text[r],s=i+o.length;if((e?n:s)>=t)return new Line(i,s,n,o);i=s+1,n++}},e.prototype.decomposeStart=function(t,n){n.push(new e(sliceText(this.text,0,t),t))},e.prototype.decomposeEnd=function(t,n){n.push(new e(sliceText(this.text,t),this.length-t))},e.prototype.lastLineLength=function(){return this.text[this.text.length-1].length},e.prototype.firstLineLength=function(){return this.text[0].length},e.split=function(t,n){for(var i=[],r=-1,o=0,s=t;o<s.length;o++)for(var a=s[o];;){var h=r+a.length+1;if(h<BASE_LEAF){r=h,i.push(a);break}var l=BASE_LEAF-r-1,c=a.charCodeAt(l);c>=56320&&c<57344&&l++,i.push(a.slice(0,l)),n.push(new e(i,BASE_LEAF)),a=a.slice(l),r=-1,i=[]}return-1!=r&&n.push(new e(i,r)),n},e}(Text),TextNode=function(t){function e(e,n){var i=t.call(this)||this;i.children=e,i.length=n,i.lines=1;for(var r=0,o=e;r<o.length;r++){var s=o[r];i.lines+=s.lines-1}return i}return __extends(e,t),e.prototype.replaceInner=function(t,n,i,r){var o,s=r-(n-t),a=this.length+s;if(a<=BASE_LEAF)return new TextLeaf(appendText(this.sliceLines(n),appendText(i,this.sliceTo(0,t,[""]))),a);for(var h=0,l=0;h<this.children.length;h++){var c=this.children[h],u=l+c.length;if(t>=l&&n<=u&&(s>0?c.length+s<Math.max(a>>TARGET_BRANCH_SHIFT-1,MAX_LEAF):c.length+s>a>>TARGET_BRANCH_SHIFT+1))return(o=this.children.slice())[h]=c.replace(t-l,n-l,i),new e(o,a);u>=t&&(null==o&&(o=this.children.slice(0,h)),l<t&&(u==t?o.push(c):c.decomposeStart(t-l,o)),l<=t&&u>=t&&TextLeaf.split(i,o),l>=n?o.push(c):u>n&&c.decomposeEnd(n-l,o)),l=u}return o?e.from(o,a):this},e.prototype.sliceTo=function(t,e,n){for(var i=0,r=0,o=this.children;r<o.length;r++){var s=o[r],a=i+s.length;e>i&&t<a&&s.sliceTo(Math.max(0,t-i),Math.min(s.length,e-i),n),i=a}return n},e.prototype.lineInner=function(t,e,n,i){for(var r=0;;r++){var o=this.children[r],s=i+o.length,a=n+o.lines-1;if((e?a:s)>=t){var h=o.lineInner(t,e,n,i),l=void 0;return h.start==i&&(l=this.lineLengthTo(r))&&(h.start-=l,h.content=null),h.end==s&&(l=this.lineLengthFrom(r+1))&&(h.end+=l,h.content=null),h}i=s,n=a}},e.prototype.decomposeStart=function(t,e){for(var n=0,i=0;;n++){var r=this.children[n],o=i+r.length;if(!(o<=t)){i<t&&r.decomposeStart(t-i,e);break}e.push(r),i=o}},e.prototype.decomposeEnd=function(t,e){for(var n=0,i=0,r=this.children;i<r.length;i++){var o=r[i],s=n+o.length;n>=t?e.push(o):s>t&&n<t&&o.decomposeEnd(t-n,e),n=s}},e.prototype.lineLengthTo=function(t){for(var e=0,n=t-1;n>=0;n--){var i=this.children[n];if(i.lines>1)return e+i.lastLineLength();e+=i.length}return e},e.prototype.lastLineLength=function(){return this.lineLengthTo(this.children.length)},e.prototype.lineLengthFrom=function(t){for(var e=0,n=t;n<this.children.length;n++){var i=this.children[n];if(i.lines>1)return e+i.firstLineLength();e+=i.length}return e},e.prototype.firstLineLength=function(){return this.lineLengthFrom(0)},e.from=function(t,n){if(n<MAX_LEAF){for(var i=[""],r=0,o=t;r<o.length;r++){(m=o[r]).sliceTo(0,m.length,i)}return new TextLeaf(i,n)}var s=Math.max(BASE_LEAF,n>>TARGET_BRANCH_SHIFT),a=s<<1,h=s>>1,l=[],c=0,u=[];function f(t){var n,i=t.length;if(i>a&&t instanceof e)for(var r=0,o=t.children;r<o.length;r++){f(o[r])}else i>h&&(c>h||0==c)?(d(),l.push(t)):t instanceof TextLeaf&&c>0&&(n=u[u.length-1])instanceof TextLeaf&&t.length+n.length<=BASE_LEAF?(c+=i,u[u.length-1]=new TextLeaf(appendText(t.text,n.text.slice()),t.length+n.length)):(c+i>s&&d(),c+=i,u.push(t))}function d(){0!=c&&(l.push(1==u.length?u[0]:e.from(u,c)),c=0,u.length=0)}for(var p=0,g=t;p<g.length;p++){var m;f(m=g[p])}return d(),1==l.length?l[0]:new e(l,n)},e}(Text);function textLength(t){for(var e=-1,n=0,i=t;n<i.length;n++){e+=i[n].length+1}return e}function appendText(t,e,n,i){void 0===n&&(n=0),void 0===i&&(i=1e9);for(var r=0,o=0,s=!0;o<t.length&&r<=i;o++){var a=t[o],h=r+a.length;h>=n&&(h>i&&(a=a.slice(0,i-r)),r<n&&(a=a.slice(n-r)),s?(e[e.length-1]+=a,s=!1):e.push(a)),r=h+1}return e}function sliceText(t,e,n){return appendText(t,[""],e,n)}function eqContent(t,e){if(t.length!=e.length||t.lines!=e.lines)return!1;for(var n=new RawTextCursor(t),i=new RawTextCursor(e),r=0,o=0;;){if(n.lineBreak!=i.lineBreak||n.done!=i.done)return!1;if(n.done)return!0;if(n.lineBreak)n.next(),i.next(),r=o=0;else{var s=n.value.slice(r),a=i.value.slice(o);if(s.length==a.length){if(s!=a)return!1;n.next(),i.next(),r=o=0}else if(s.length>a.length){if(s.slice(0,a.length)!=a)return!1;r+=a.length,i.next(),o=0}else{if(a.slice(0,s.length)!=s)return!1;o+=s.length,n.next(),r=0}}}}var RawTextCursor=function(){function t(t,e){void 0===e&&(e=1),this.dir=e,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[t],this.offsets=[e>0?0:t instanceof TextLeaf?t.text.length:t.children.length]}return t.prototype.next=function(t){for(void 0===t&&(t=0);;){var e=this.nodes.length-1;if(e<0)return this.done=!0,this.value="",this.lineBreak=!1,this;var n=this.nodes[e],i=this.offsets[e];if(n instanceof TextLeaf){if(i!=(this.dir>0?0:n.text.length)&&!this.lineBreak){if(this.lineBreak=!0,0==t)return this.value="\n",this;t--;continue}var r=n.text[i-(this.dir<0?1:0)];if(this.offsets[e]=i+=this.dir,i==(this.dir>0?n.text.length:0)&&(this.nodes.pop(),this.offsets.pop()),this.lineBreak=!1,r.length>t)return this.value=0==t?r:this.dir>0?r.slice(t):r.slice(0,r.length-t),this;t-=r.length}else if(i==(this.dir>0?n.children.length:0))this.nodes.pop(),this.offsets.pop();else{var o=(r=n.children[this.dir>0?i:i-1]).length;this.offsets[e]=i+this.dir,t>o?t-=o:(this.nodes.push(r),this.offsets.push(this.dir>0?0:r instanceof TextLeaf?r.text.length:r.children.length))}}},t}(),PartialTextCursor=function(){function t(t,e,n){this.value="",this.cursor=new RawTextCursor(t,e>n?-1:1),e>n?(this.skip=t.length-e,this.limit=e-n):(this.skip=e,this.limit=n-e)}return t.prototype.next=function(){if(this.limit<=0)this.limit=-1;else{var t=this.cursor.next(this.skip),e=t.value,n=t.lineBreak;this.skip=0,this.value=e;var i=n?1:e.length;i>this.limit&&(this.value=this.cursor.dir>0?e.slice(0,this.limit):e.slice(i-this.limit)),this.limit-=this.value.length}return this},Object.defineProperty(t.prototype,"lineBreak",{get:function(){return this.cursor.lineBreak},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"done",{get:function(){return this.limit<0},enumerable:!0,configurable:!0}),t}(),LineCursor=function(){function t(t,e){void 0===e&&(e=0),this.value="",this.done=!1,this.cursor=t.iter(),this.skip=e}return t.prototype.next=function(){if(this.cursor.done)return this.done=!0,this.value="",this;for(this.value="";;){var t=this.cursor.next(this.skip),e=t.value,n=t.lineBreak,i=t.done;if(this.skip=0,i||n)return this;this.value+=e}},Object.defineProperty(t.prototype,"lineBreak",{get:function(){return!1},enumerable:!0,configurable:!0}),t}(),Line=function(){function t(t,e,n,i){this.start=t,this.end=e,this.number=n,this.content=i}return Object.defineProperty(t.prototype,"length",{get:function(){return this.end-this.start},enumerable:!0,configurable:!0}),t.prototype.slice=function(t,e){if(void 0===t&&(t=0),void 0===e&&(e=this.length),"string"==typeof this.content)return e==t+1?this.content.charAt(t):this.content.slice(t,e);if(t==e)return"";var n=this.content.slice(t,e);return 0==t&&e==this.length&&(this.content=n),n},t.prototype.finish=function(t){return null==this.content&&(this.content=new LineContent(t,this.start)),this},t}(),LineContent=function(){function t(t,e){this.doc=t,this.start=e,this.cursor=null,this.strings=null}return t.prototype.slice=function(t,e){this.cursor||(this.cursor=this.doc.iter(),this.strings=[this.cursor.next(this.start).value]);for(var n="",i=0,r=0;;r++){r==this.strings.length&&this.strings.push(this.cursor.next().value);var o=this.strings[r],s=i+o.length;if(!(s<=t)){if(n+=o.slice(Math.max(0,t-i),Math.min(o.length,e-i)),s>=e)return n;i+=o.length}}},t}(),SelectionRange=function(){function t(t,e){void 0===e&&(e=t),this.anchor=t,this.head=e}return Object.defineProperty(t.prototype,"from",{get:function(){return Math.min(this.anchor,this.head)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"to",{get:function(){return Math.max(this.anchor,this.head)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this.anchor==this.head},enumerable:!0,configurable:!0}),t.prototype.map=function(e){var n=e.mapPos(this.anchor),i=e.mapPos(this.head);return n==this.anchor&&i==this.head?this:new t(n,i)},t.prototype.extend=function(e,n){if(void 0===n&&(n=e),e<=this.anchor&&n>=this.anchor)return new t(e,n);var i=Math.abs(e-this.anchor)>Math.abs(n-this.anchor)?e:n;return new t(this.anchor,i)},t.prototype.eq=function(t){return this.anchor==t.anchor&&this.head==t.head},t.groupAt=function(e,n,i){void 0===i&&(i=1);var r=e.doc.lineAt(n),o=n-r.start;if(0==r.length)return new t(n);0==o?i=1:o==r.length&&(i=-1);for(var s=o+(i<0?-1:0),a=charType(r.slice(s,s+1)),h=n,l=n,c=o;c>0&&charType(r.slice(c-1,c))==a;c--)h--;for(var u=o;u<r.length&&charType(r.slice(u,u+1))==a;u++)l++;return new t(l,h)},t}(),EditorSelection=function(){function t(t,e){void 0===e&&(e=0),this.ranges=t,this.primaryIndex=e}return t.prototype.map=function(e){return t.create(this.ranges.map(function(t){return t.map(e)}),this.primaryIndex)},t.prototype.eq=function(t){if(this.ranges.length!=t.ranges.length||this.primaryIndex!=t.primaryIndex)return!1;for(var e=0;e<this.ranges.length;e++)if(!this.ranges[e].eq(t.ranges[e]))return!1;return!0},Object.defineProperty(t.prototype,"primary",{get:function(){return this.ranges[this.primaryIndex]},enumerable:!0,configurable:!0}),t.prototype.asSingle=function(){return 1==this.ranges.length?this:new t([this.primary])},t.prototype.addRange=function(e,n){return void 0===n&&(n=!0),t.create([e].concat(this.ranges),n?0:this.primaryIndex+1)},t.prototype.replaceRange=function(e,n){void 0===n&&(n=this.primaryIndex);var i=this.ranges.slice();return i[n]=e,t.create(i,this.primaryIndex)},t.single=function(e,n){return void 0===n&&(n=e),new t([new SelectionRange(e,n)],0)},t.create=function(e,n){void 0===n&&(n=0);for(var i=0,r=0;r<e.length;r++){var o=e[r];if(o.empty?o.from<=i:o.from<i)return normalized(e.slice(),n);i=o.to}return new t(e,n)},t.default=t.single(0),t}();function normalized(t,e){void 0===e&&(e=0);var n=t[e];t.sort(function(t,e){return t.from-e.from}),e=t.indexOf(n);for(var i=1;i<t.length;i++){var r=t[i],o=t[i-1];if(r.empty?r.from<=o.to:r.from<o.to){var s=o.from,a=Math.max(r.to,o.to);i<=e&&e--,t.splice(--i,2,r.anchor>r.head?new SelectionRange(a,s):new SelectionRange(s,a))}}return new EditorSelection(t,e)}var fieldNames=Object.create(null),StateField=function(){return function(t){var e=t.init,n=t.apply,i=t.debugName,r=void 0===i?"field":i;this.init=e,this.apply=n,this.key=unique("$"+r,fieldNames)}}(),Plugin=function(){return function(t){this.spec=t,this.config=t.config,this.stateField=t.state||null,this.view=t.view}}();function unique(t,e){for(var n=0;;n++){var i=t+(n?"_"+n:"");if(!(i in e))return e[i]=i}}var empty=[],ChangeDesc=function(){function t(t,e,n){this.from=t,this.to=e,this.length=n}return Object.defineProperty(t.prototype,"invertedDesc",{get:function(){return new t(this.from,this.from+this.length,this.to-this.from)},enumerable:!0,configurable:!0}),t.prototype.mapPos=function(t,e,n){void 0===e&&(e=-1),void 0===n&&(n=!1);var i=this.from,r=this.to,o=this.length;return t<i?t:t>r?t+(o-(r-i)):t==r||t==i?(i==r?e<=0:t==i)?i:i+o:(t=i+(e<=0?0:o),n?-t-1:t)},t}(),Change=function(t){function e(e,n,i){var r=t.call(this,e,n,textLength$1(i))||this;return r.from=e,r.to=n,r.text=i,r}return __extends(e,t),e.prototype.invert=function(t){return new e(this.from,this.from+this.length,t.sliceLines(this.from,this.to))},e.prototype.apply=function(t){return t.replace(this.from,this.to,this.text)},e.prototype.map=function(t){var n=t.mapPos(this.from,1),i=t.mapPos(this.to,-1);return n>i?null:new e(n,i,this.text)},Object.defineProperty(e.prototype,"desc",{get:function(){return new ChangeDesc(this.from,this.to,this.length)},enumerable:!0,configurable:!0}),e}(ChangeDesc);function textLength$1(t){for(var e=-1,n=0,i=t;n<i.length;n++){e+=i[n].length+1}return e}var ChangeSet=function(){function t(t,e){void 0===e&&(e=empty),this.changes=t,this.mirror=e}return Object.defineProperty(t.prototype,"length",{get:function(){return this.changes.length},enumerable:!0,configurable:!0}),t.prototype.getMirror=function(t){for(var e=0;e<this.mirror.length;e++)if(this.mirror[e]==t)return this.mirror[e+(e%2?-1:1)];return null},t.prototype.append=function(e,n){return new t(this.changes.concat(e),null!=n?this.mirror.concat(this.length,n):this.mirror)},t.prototype.appendSet=function(e){var n=this;return 0==e.length?this:0==this.length?e:new t(this.changes.concat(e.changes),this.mirror.concat(e.mirror.map(function(t){return t+n.length})))},t.prototype.mapPos=function(t,e,n){return void 0===e&&(e=-1),void 0===n&&(n=!1),this.mapInner(t,e,n,0,this.length)},t.prototype.mapInner=function(t,e,n,i,r){for(var o,s,a=r<i?-1:1,h=null,l=this.mirror.length>0,c=!1,u=i-(a<0?1:0),f=r-(a<0?1:0);u!=f;u+=a){var d=this.changes[u],p=d.from,g=d.to,m=d.length;if(a<0){var v=g-p;g=p+m,m=v}if(!(t<p))if(t>g)t+=m-(g-p);else if(h&&null!=(o=h[u]))t=p+o;else{if(l&&null!=(s=this.getMirror(u))&&(a>0?s>u&&s<r:s<u&&s>=r)){if(t>p&&t<g){u=s,t=this.changes[u].from+(t-p);continue}(h||(h={}))[s]=t-p}t>p&&t<g?(c=!0,t=e<=0?p:p+m):t=(p==g?e<=0:t==p)?p:p+m}}return n&&c?-t-1:t},t.prototype.partialMapping=function(t,e){return void 0===e&&(e=this.length),0==t&&e==this.length?this:new PartialMapping(this,t,e)},t.prototype.changedRanges=function(){for(var t=[],e=0;e<this.length;e++){var n,i=this.changes[e],r=i.from,o=i.to,s=i.from,a=i.from+i.length;if(e<this.length-1)s=(n=this.partialMapping(e+1)).mapPos(s,1),a=n.mapPos(a,-1);if(e>0)r=(n=this.partialMapping(e,0)).mapPos(r,1),o=n.mapPos(o,-1);new ChangedRange(r,o,s,a).addToSet(t)}return t},Object.defineProperty(t.prototype,"desc",{get:function(){return 0==this.changes.length||this.changes[0]instanceof ChangeDesc?this:new t(this.changes.map(function(t){return t.desc}),this.mirror)},enumerable:!0,configurable:!0}),t.empty=new t(empty),t}(),PartialMapping=function(){function t(t,e,n){this.changes=t,this.from=e,this.to=n}return t.prototype.mapPos=function(t,e,n){return void 0===e&&(e=-1),void 0===n&&(n=!1),this.changes.mapInner(t,e,n,this.from,this.to)},t}(),ChangedRange=function(){function t(t,e,n,i){this.fromA=t,this.toA=e,this.fromB=n,this.toB=i}return t.prototype.join=function(e){return new t(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))},t.prototype.addToSet=function(t){for(var e=t.length,n=this;e>0;e--){var i=t[e-1];if(!(i.fromA>n.toA)){if(i.toA<n.fromA)break;n=n.join(i),t.splice(e-1,1)}}t.splice(e,0,n)},t}(),empty$1=[],Meta=function(){return function(t){if(void 0===t&&(t=null),t)for(var e in t)this[e]=t[e]}}();Meta.prototype.__proto__=null;var metaSlotNames=Object.create(null),MetaSlot=function(){function t(t){void 0===t&&(t="meta"),this.name=unique(t,metaSlotNames)}return t.time=new t("time"),t.changeTabSize=new t("changeTabSize"),t.changeLineSeparator=new t("changeLineSeparator"),t.preserveGoalColumn=new t("preserveGoalColumn"),t.userEvent=new t("userEvent"),t.addToHistory=new t("addToHistory"),t}(),FLAG_SELECTION_SET=1,FLAG_SCROLL_INTO_VIEW=2,Transaction=function(){function t(t,e,n,i,r,o){this.startState=t,this.changes=e,this.docs=n,this.selection=i,this.meta=r,this.flags=o}return t.start=function(e,n){void 0===n&&(n=Date.now());var i=new Meta;return i[MetaSlot.time.name]=n,new t(e,ChangeSet.empty,empty$1,e.selection,i,0)},Object.defineProperty(t.prototype,"doc",{get:function(){var t=this.docs.length-1;return t<0?this.startState.doc:this.docs[t]},enumerable:!0,configurable:!0}),t.prototype.setMeta=function(e,n){var i=new Meta(this.meta);return i[e.name]=n,new t(this.startState,this.changes,this.docs,this.selection,i,this.flags)},t.prototype.getMeta=function(t){return this.meta[t.name]},t.prototype.change=function(e,n){if(e.from==e.to&&0==e.length)return this;if(e.from<0||e.to<e.from||e.to>this.doc.length)throw new RangeError("Invalid change "+e.from+" to "+e.to);var i=this.changes.append(e,n);return new t(this.startState,i,this.docs.concat(e.apply(this.doc)),this.selection.map(i.partialMapping(i.length-1)),this.meta,this.flags)},t.prototype.replace=function(t,e,n){return this.change(new Change(t,e,"string"==typeof n?this.startState.splitLines(n):n))},t.prototype.replaceSelection=function(t){var e="string"==typeof t?this.startState.splitLines(t):t;return this.reduceRanges(function(t,n){var i=new Change(n.from,n.to,e);return{transaction:t.change(i),range:new SelectionRange(n.from+i.length)}})},t.prototype.reduceRanges=function(e){for(var n=this,i=n.selection,r=n.changes.length,o=[],s=0,a=i.ranges;s<a.length;s++){var h=a[s];h=h.map(n.changes.partialMapping(r));var l=e(n,h);l instanceof t?(n=l,o.push(h.map(n.changes.partialMapping(n.changes.length-1)))):(n=l.transaction,o.push(l.range))}return n.setSelection(EditorSelection.create(o,i.primaryIndex))},t.prototype.mapRanges=function(t){return this.reduceRanges(function(e,n){return{transaction:e,range:t(n)}})},t.prototype.setSelection=function(e){return new t(this.startState,this.changes,this.docs,this.startState.multipleSelections?e:e.asSingle(),this.meta,this.flags|FLAG_SELECTION_SET)},Object.defineProperty(t.prototype,"selectionSet",{get:function(){return(this.flags&FLAG_SELECTION_SET)>0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"docChanged",{get:function(){return this.changes.length>0},enumerable:!0,configurable:!0}),t.prototype.scrollIntoView=function(){return new t(this.startState,this.changes,this.docs,this.selection,this.meta,this.flags|FLAG_SCROLL_INTO_VIEW)},Object.defineProperty(t.prototype,"scrolledIntoView",{get:function(){return(this.flags&FLAG_SCROLL_INTO_VIEW)>0},enumerable:!0,configurable:!0}),t.prototype.apply=function(){return this.startState.applyTransaction(this)},t.prototype.invertedChanges=function(){if(!this.changes.length)return ChangeSet.empty;for(var t=[],e=this.changes,n=e.length-1;n>=0;n--)t.push(e.changes[n].invert(0==n?this.startState.doc:this.docs[n-1]));return new ChangeSet(t,e.mirror.length?e.mirror.map(function(t){return e.length-t-1}):e.mirror)},t}(),Configuration=function(){function t(t,e,n,i,r){this.plugins=t,this.fields=e,this.multipleSelections=n,this.tabSize=i,this.lineSeparator=r}return t.create=function(e){for(var n=e.plugins||[],i=[],r=!!e.multipleSelections,o=0,s=n;o<s.length;o++){var a=s[o];a.spec.multipleSelections&&(r=!0);var h=a.stateField;if(h){if(i.indexOf(h)>-1)throw new Error("A state field ("+h.key+") can only be added to a state once");i.push(h)}}return new t(n,i,r,e.tabSize||4,e.lineSeparator||null)},t.prototype.updateTabSize=function(e){return new t(this.plugins,this.fields,this.multipleSelections,e,this.lineSeparator)},t.prototype.updateLineSeparator=function(e){return new t(this.plugins,this.fields,this.multipleSelections,this.tabSize,e)},t}(),EditorState=function(){function t(t,e,n){void 0===n&&(n=EditorSelection.default),this.config=t,this.doc=e,this.selection=n}return t.prototype.getField=function(t){return this[t.key]},Object.defineProperty(t.prototype,"plugins",{get:function(){return this.config.plugins},enumerable:!0,configurable:!0}),t.prototype.getPluginWithField=function(t){for(var e=0,n=this.config.plugins;e<n.length;e++){var i=n[e];if(i.stateField==t)return i}throw new Error("Plugin for field not configured")},t.prototype.applyTransaction=function(e){var n=this.config,i=e.getMeta(MetaSlot.changeTabSize),r=e.getMeta(MetaSlot.changeLineSeparator);void 0!==i&&(n=n.updateTabSize(i)),void 0!==r&&(n=n.updateLineSeparator(r));for(var o=new t(n,e.doc,e.selection),s=0,a=n.fields;s<a.length;s++){var h=a[s];o[h.key]=h.apply(e,this[h.key],o)}return o},Object.defineProperty(t.prototype,"transaction",{get:function(){return Transaction.start(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tabSize",{get:function(){return this.config.tabSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"multipleSelections",{get:function(){return this.config.multipleSelections},enumerable:!0,configurable:!0}),t.prototype.joinLines=function(t){return joinLines(t,this.config.lineSeparator||void 0)},t.prototype.splitLines=function(t){return splitLines(t,this.config.lineSeparator||void 0)},t.create=function(e){void 0===e&&(e={});var n=Configuration.create(e),i=e.doc instanceof Text?e.doc:Text.of(e.doc||"",e.lineSeparator||void 0),r=e.selection||EditorSelection.default;n.multipleSelections||(r=r.asSingle());for(var o=new t(n,i,r),s=0,a=n.fields;s<a.length;s++){var h=a[s];o[h.key]=h.init(o)}return o},t}(),_a="undefined"!=typeof navigator?[navigator,document]:[{userAgent:"",vendor:"",platform:""},{documentElement:{style:{}}}],nav=_a[0],doc=_a[1],ie_edge=/Edge\/(\d+)/.exec(nav.userAgent),ie_upto10=/MSIE \d/.test(nav.userAgent),ie_11up=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(nav.userAgent),ie=!!(ie_upto10||ie_11up||ie_edge),gecko=!ie&&/gecko\/(\d+)/i.test(nav.userAgent),chrome=!ie&&/Chrome\/(\d+)/.exec(nav.userAgent),webkit=!ie&&"WebkitAppearance"in doc.documentElement.style,browser={mac:/Mac/.test(nav.platform),ie:ie,ie_version:ie_upto10?doc.documentMode||6:ie_11up?+ie_11up[1]:ie_edge?+ie_edge[1]:0,gecko:gecko,gecko_version:gecko?+(/Firefox\/(\d+)/.exec(nav.userAgent)||[0,0])[1]:0,chrome:!!chrome,chrome_version:chrome?+chrome[1]:0,ios:!ie&&/AppleWebKit/.test(nav.userAgent)&&/Mobile\/\w+/.test(nav.userAgent),android:/Android\b/.test(nav.userAgent),webkit:webkit,safari:/Apple Computer/.test(nav.vendor),webkit_version:webkit?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0},getRoot="undefined"==typeof document||document.getRootNode?function(t){var e=t.getRootNode();return 9==e.nodeType||11==e.nodeType?e:document}:function(){return document};function selectionCollapsed(t){var e=t.isCollapsed;return e&&browser.chrome&&t.rangeCount&&!t.getRangeAt(0).collapsed&&(e=!1),e}function hasSelection(t){var e=getRoot(t).getSelection();if(!e.anchorNode)return!1;try{return t.contains(3==e.anchorNode.nodeType?e.anchorNode.parentNode:e.anchorNode)}catch(t){return!1}}function clientRectsFor(t){if(3==t.nodeType){var e=document.createRange();return e.setEnd(t,t.nodeValue.length),e.setStart(t,0),e.getClientRects()}return 1==t.nodeType?t.getClientRects():[]}function isEquivalentPosition(t,e,n,i){return!!n&&(scanFor(t,e,n,i,-1)||scanFor(t,e,n,i,1))}function domIndex(t){for(var e=0;;e++)if(!(t=t.previousSibling))return e}function scanFor(t,e,n,i,r){for(;;){if(t==n&&e==i)return!0;if(e==(r<0?0:maxOffset(t))){if("DIV"==t.nodeName||"PRE"==t.nodeName)return!1;var o=t.parentNode;if(!o||1!=o.nodeType)return!1;e=domIndex(t)+(r<0?0:1),t=o}else{if(1!=t.nodeType)return!1;t=t.childNodes[e+(r<0?-1:0)],e=r<0?maxOffset(t):0}}}function maxOffset(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}function windowRect(t){return{left:0,right:t.innerWidth,top:0,bottom:t.innerHeight}}function scrollRectIntoView(t,e){var n=t.ownerDocument.defaultView,i=0,r=t.previousSibling;r&&"sticky"==getComputedStyle(r).position&&(i=t.offsetLeft);for(var o=t.parentNode;o;)if(1==o.nodeType){var s=void 0,a=o==document.body;if(a)s=windowRect(n);else{if(o.scrollHeight<=o.clientHeight&&o.scrollWidth<=o.clientWidth){o=o.parentNode;continue}var h=o.getBoundingClientRect();s={left:h.left,right:h.left+o.clientWidth,top:h.top,bottom:h.top+o.clientHeight}}var l=0,c=0;if(e.top<s.top+0?c=-(s.top-e.top+5):e.bottom>s.bottom-0&&(c=e.bottom-s.bottom+5),e.left<s.left+i+0?l=-(s.left+i-e.left+5):e.right>s.right-0&&(l=e.right-s.right+5),(l||c)&&(a?n.scrollBy(l,c):(c&&(o.scrollTop+=c),l&&(o.scrollLeft+=l),e={left:e.left-l,top:e.top-c,right:e.right-l,bottom:e.bottom-c})),a)break;o=o.parentNode}else{if(11!=o.nodeType)break;o=o.host}}var DOMSelection=function(){function t(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}return t.prototype.eq=function(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset},t.prototype.set=function(t){this.anchorNode=t.anchorNode,this.anchorOffset=t.anchorOffset,this.focusNode=t.focusNode,this.focusOffset=t.focusOffset},t}(),none=[],ContentView=function(){function t(t,e){this.parent=t,this.dom=e,this.dirty=0,e&&(e.cmView=this)}return Object.defineProperty(t.prototype,"childGap",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"overrideDOMText",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"posAtStart",{get:function(){return this.parent?this.parent.posBefore(this):0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"posAtEnd",{get:function(){return this.posAtStart+this.length},enumerable:!0,configurable:!0}),t.prototype.posBefore=function(t){for(var e=this.posAtStart,n=0,i=this.children;n<i.length;n++){var r=i[n];if(r==t)return e;e+=r.length+this.childGap}throw new RangeError("Invalid child in posBefore")},t.prototype.posAfter=function(t){return this.posBefore(t)+t.length},t.prototype.coordsAt=function(t){for(var e=0,n=0;n<this.children.length;n++){var i=this.children[n],r=e+i.length;if(r>=t&&(r!=e||this.childGap))return i.coordsAt(t-e);e=r+this.childGap}return null},t.prototype.syncInto=function(t,e){return syncNodeInto(t,e,this.dom)},t.prototype.syncDOMChildren=function(){for(var t=this.dom,e=t.firstChild,n=0,i=this.children;n<i.length;n++){e=i[n].syncInto(t,e)}for(;e;)e=rm(e)},t.prototype.sync=function(){if(2&this.dirty&&this.syncDOMChildren(),1&this.dirty)for(var t=0,e=this.children;t<e.length;t++){var n=e[t];n.dirty&&n.sync()}this.dirty=0},t.prototype.domFromPos=function(t){return null},t.prototype.localPosFromDOM=function(t,e){var n;if(t==this.dom)n=this.dom.childNodes[e];else{for(var i=0==maxOffset(t)?0:0==e?-1:1;;){var r=t.parentNode;if(r==this.dom)break;0==i&&r.firstChild!=r.lastChild&&(i=t==r.firstChild?-1:1),t=r}n=i<0?t:t.nextSibling}if(n==this.dom.firstChild)return 0;for(;n&&!n.cmView;)n=n.nextSibling;if(!n)return this.length;for(var o=0,s=0;;o++){var a=this.children[o];if(a.dom==n)return s;s+=a.length+this.childGap}},t.prototype.domBoundsAround=function(t,e,n){void 0===n&&(n=0);for(var i=-1,r=-1,o=-1,s=-1,a=0,h=n;a<this.children.length;a++){var l=this.children[a],c=h+l.length;if(h<t&&c>e)return l.domBoundsAround(t,e,h);if(c>=t&&-1==i&&(i=a,r=h),c>=e&&-1==o){o=a,s=c;break}h=c+this.childGap}return{from:r,to:s,startDOM:(i?this.children[i-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:o<this.children.length-1?this.children[o+1].dom:null}},t.prototype.markDirty=function(){2&this.dirty||(this.dirty|=2,this.markParentsDirty())},t.prototype.markParentsDirty=function(){for(var t=this.parent;t;t=t.parent){if(1&t.dirty)return;t.dirty|=1}},t.prototype.setParent=function(t){this.parent=t,this.dirty&&this.markParentsDirty()},t.prototype.replaceChildren=function(t,e,n){var i;void 0===n&&(n=none),(i=this.children).splice.apply(i,[t,e-t].concat(n)),this.markDirty()},t.prototype.ignoreMutation=function(t){return!1},t.prototype.ignoreEvent=function(t){return!1},t.prototype.childPos=function(t,e){return void 0===e&&(e=1),new ChildCursor(this.children,this.length,this.childGap).findPos(t,e)},t}();function rm(t){var e=t.nextSibling;return t.parentNode.removeChild(t),e}function syncNodeInto(t,e,n){if(n.parentNode==t){for(;e!=n;)e=rm(e);e=n.nextSibling}else t.insertBefore(n,e);return e}var ChildCursor=function(){function t(t,e,n,i){void 0===n&&(n=0),void 0===i&&(i=t.length),this.children=t,this.pos=e,this.gap=n,this.i=i,this.off=0,this.pos+=n}return t.prototype.findPos=function(t,e){for(void 0===e&&(e=1);;){if(t>this.pos||t==this.pos&&(e>0||0==this.i))return this.off=t-this.pos,this;this.pos-=this.children[--this.i].length+this.gap}},t}(),Range=function(){function t(t,e,n){this.from=t,this.to=e,this.value=n}return t.prototype.map=function(t,e,n){var i=this.value.map(t,this.from+e,this.to+e);return i&&(i.from-=n,i.to-=n),i},t.prototype.move=function(e){return e?new t(this.from+e,this.to+e,this.value):this},Object.defineProperty(t.prototype,"heapPos",{get:function(){return this.to},enumerable:!0,configurable:!0}),t}(),none$1=[];function maybeNone(t){return t.length?t:none$1}var BASE_NODE_SIZE_SHIFT=5,BASE_NODE_SIZE=1<<BASE_NODE_SIZE_SHIFT,RangeSet=function(){function t(t,e,n,i){this.length=t,this.size=e,this.local=n,this.children=i}return t.prototype.update=function(t,e,n,i){void 0===t&&(t=none$1),void 0===e&&(e=null),void 0===n&&(n=0),void 0===i&&(i=this.length);var r=t.reduce(function(t,e){return Math.max(t,e.to)},this.length);return this.updateInner(t.length?t.slice().sort(byPos):t,e,n,i,0,r)},t.prototype.updateInner=function(e,n,i,r,o,s){for(var a=filterRanges(this.local,n,i,r,o),h=null,l=0,c=0,u=o,f=0;f<this.children.length;f++){for(var d=this.children[f],p=u+d.length,g=null;c<e.length;){var m=e[c];if(m.from>=p)break;c++,m.to>p?(a||(a=this.local.slice()),insertSorted(a,m.move(-o))):(g||(g=[])).push(m)}var v=d;(g||n&&i<=p&&r>=u)&&(v=v.updateInner(g||none$1,n,i,r,u,v.length)),v!=d?(h||(h=this.children.slice(0,f))).push(v):h&&h.push(v),l+=v.size,u=p}if(!a&&!h&&c==e.length)return this;if((l+=(a||this.local).length+e.length-c)<=BASE_NODE_SIZE)return collapseSet(h||this.children,a||this.local.slice(),e,c,o,s);var y=Math.max(BASE_NODE_SIZE,l>>BASE_NODE_SIZE_SHIFT);return c<e.length&&(h||(h=this.children.slice()),a||(a=this.local.slice()),appendRanges(a,h,e,c,o,s,u,y)),h&&(a||(a=this.local.slice()),rebalanceChildren(a,h,y)),new t(s,l,maybeNone(a||this.local),maybeNone(h||this.children))},t.prototype.grow=function(e){return new t(this.length+e,this.size,this.local,this.children)},t.prototype.collect=function(t,e){for(var n=0,i=this.local;n<i.length;n++){var r=i[n];t.push(r.move(e))}for(var o=0,s=this.children;o<s.length;o++){var a=s[o];a.collect(t,e),e+=a.length}},t.prototype.map=function(e){return 0==e.length||this==t.empty?this:this.mapInner(e,0,0,e.mapPos(this.length,1)).set},t.prototype.mapInner=function(e,n,i,r){for(var o=null,s=null,a=r-i,h=0,l=0;l<this.local.length;l++){var c=(C=this.local[l]).map(e,n,i),u=null!=c&&(c.from<0||c.to>a);null!=o||C==c&&!u||(o=this.local.slice(0,l)),u?(s||(s=[])).push(c):o&&c&&o.push(c)}for(var f=null,d=(l=0,n),p=i;l<this.children.length;l++){var g=this.children[l],m=g,v=d+g.length,y=e.mapPos(d+g.length,1),w=touchesChanges(d,v,e.changes);if(0==w){var b=g.mapInner(e,d,p,y);if(m=b.set,b.escaped)for(var S=0,x=b.escaped;S<x.length;S++){var C;(C=(C=x[S]).move(p-i)).from<0||C.to>a?insertSorted(s||(s=[]),C):insertSorted(o||(o=this.local.slice()),C)}}else 2==w&&(m=t.empty.grow(y-p));if(m!=g){if(null==f&&(f=this.children.slice(0,l)),0!=m.size||0!=m.length&&!f.length&&l!=this.children.length)f.push(m);else if(m.length>0&&l>0){var M=f.length-1,A=f[M];f[M]=new t(A.length+m.length,A.size,A.local,A.children)}}else f&&f.push(m);h+=m.size,d=v,p=y}return{set:a==this.length&&null==f&&null==o?this:new t(a,h+(o||this.local).length,o||this.local,f||this.children),escaped:s}},t.prototype.forEach=function(t){this.forEachInner(t,0)},t.prototype.forEachInner=function(t,e){for(var n=0,i=this.local;n<i.length;n++){var r=i[n];t(r.from+e,r.to+e,r.value)}for(var o=0,s=this.children;o<s.length;o++){var a=s[o];a.forEachInner(t,e),e+=a.length}},t.prototype.iter=function(){var t=[];return this.size>0&&(addIterToHeap(t,[new IteratedSet(0,this)],0),this.local.length&&addToHeap(t,new LocalSet(0,this.local))),{next:function(){if(0!=t.length){var e=takeFromHeap(t);if(e instanceof LocalSet){var n=e.ranges[e.index].move(e.offset);return++e.index<e.ranges.length?addToHeap(t,e):e.next&&addIterToHeap(t,e.next,0),n}return e}}}},t.prototype.compare=function(t,e,n,i){for(var r=0,o=0,s=0,a=e;s<a.length;s++){var h=a[s];h.fromB>o&&(this!=t||r!=o)&&new RangeSetComparison(this,r,t,o,h.fromB,n).run(),r=h.toA,o=h.toB}(r<this.length||o<t.length)&&new RangeSetComparison(this,r,t,o,o+(i-r),n).run()},t.iterateSpans=function(t,e,n,i){for(var r=[],o=0,s=t;o<s.length;o++){var a=s[o];a.size>0&&(addIterToHeap(r,[new IteratedSet(0,a)],e),a.local.length&&addToHeap(r,new LocalSet(0,a.local)))}for(var h=[];r.length>0;){var l=takeFromHeap(r);if(l instanceof LocalSet){if((c=l.ranges[l.index]).from+l.offset>n)break;if(c.to+l.offset>=e)if(c.from<c.to&&!i.ignoreRange(c.value))c=c.move(l.offset),i.advance(c.from,h),c.value.collapsed?(e=c.to,i.advanceCollapsed(Math.min(e,n),c.value)):(h.push(c.value),addToHeap(r,c));else c.from!=c.to||i.ignorePoint(c.value)||(i.advance(c.from,h),i.point(c.value));++l.index<l.ranges.length?addToHeap(r,l):l.next&&addIterToHeap(r,l.next,e)}else{var c;if((c=l).to>=n)break;i.advance(c.to,h),h.splice(h.indexOf(c.value),1)}}i.advance(n,h)},t.of=function(e){return t.empty.update(e instanceof Range?[e]:e)},t.empty=new t(0,0,none$1,none$1),t}(),IteratedSet=function(){return function(t,e){this.offset=t,this.set=e,this.index=0}}(),LocalSet=function(){function t(t,e,n){void 0===n&&(n=null),this.offset=t,this.ranges=e,this.next=n,this.index=0}return Object.defineProperty(t.prototype,"heapPos",{get:function(){return this.ranges[this.index].from+this.offset},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.ranges[this.index].value},enumerable:!0,configurable:!0}),t}();function iterRangeSet(t,e){for(void 0===e&&(e=0);0!=t.length;){var n=t[t.length-1];if(n.index==n.set.children.length)t.pop();else{var i=n.set.children[n.index],r=n.offset;if(n.index++,n.offset+=i.length,n.offset>=e){t.push(new IteratedSet(r,i));break}}}}function compareHeapable(t,e){return t.heapPos-e.heapPos||t.value.bias-e.value.bias}function addIterToHeap(t,e,n){for(void 0===n&&(n=0);iterRangeSet(e,n),0!=e.length;){var i=e[e.length-1],r=i.set.local,o=i.set.children.length?null:e;if(r.length&&addToHeap(t,new LocalSet(i.offset,r,o)),o)break}}function addToHeap(t,e){for(var n=t.push(e)-1;n>0;){var i=n>>1,r=t[i];if(compareHeapable(e,r)>=0)break;t[n]=r,t[i]=e,n=i}}function takeFromHeap(t){var e=t[0],n=t.pop();if(0==t.length)return e;t[0]=n;for(var i=0;;){var r=1+(i<<1);if(r>=t.length)break;var o=t[r];if(r+1<t.length&&compareHeapable(o,t[r+1])>=0&&(o=t[r+1],r++),compareHeapable(n,o)<0)break;t[r]=n,t[i]=o,i=r}return e}function byPos(t,e){return t.from-e.from||t.value.bias-e.value.bias}function insertSorted(t,e){for(var n=t.length;n>0&&byPos(t[n-1],e)>=0;)n--;t.splice(n,0,e)}function filterRanges(t,e,n,i,r){if(!e)return null;for(var o=null,s=0;s<t.length;s++){var a=t[s],h=a.from+r,l=a.to+r;n>l||i<h||e(h,l,a.value)?null!=o&&o.push(a):null==o&&(o=t.slice(0,s))}return o}function collapseSet(t,e,n,i,r,o){for(var s=e.length>0&&n.length>0,a=0,h=0,l=t;h<l.length;h++){var c=l[h];c.collect(e,-a),a+=c.length}for(var u=0,f=n;u<f.length;u++){var d=f[u];e.push(d.move(-r))}return s&&e.sort(byPos),new RangeSet(o,e.length,e,none$1)}function appendRanges(t,e,n,i,r,o,s,a){for(var h=i;h<n.length;){for(var l=[],c=Math.min(h+a,n.length),u=c==n.length?r+o:n[c].from;h<c;h++){(d=n[h]).to>u?insertSorted(t,d.move(-r)):l.push(d)}for(var f=0;f<t.length;f++){var d;(d=t[f]).from>=s&&d.to<=u&&(t.splice(f--,1),insertSorted(l,d.move(r)))}l.length&&(l.length==n.length?e.push(new RangeSet(u-s,l.length,l.map(function(t){return t.move(-s)}),none$1)):e.push(RangeSet.empty.updateInner(l,null,0,0,s,u-s)),s=u)}}function rebalanceChildren(t,e,n){for(var i,r,o=function(o,s){var a=e[o],h=void 0;if(0==a.size&&(o>0||1==e.length))e.splice(o--,1),o>=0&&(e[o]=e[o].grow(a.length));else if(a.size>n<<1&&a.local.length<a.length>>1){for(var l=0,c=a.local;l<c.length;l++){var u=c[l];insertSorted(t,u.move(s))}e.splice.apply(e,[o,1].concat(a.children))}else if(0==a.children.length&&o<e.length-1&&(h=e[o+1]).size+a.size<=BASE_NODE_SIZE&&0==h.children.length)e.splice(o,2,new RangeSet(a.length+h.length,a.size+h.size,a.local.concat(h.local.map(function(t){return t.move(a.length)})),none$1));else{var f=o+1,d=a.size,p=a.length;if(a.size<n>>1)for(;f<e.length;f++){var g=e[f],m=d+g.size;if(m>n)break;d=m,p+=g.length}if(f>o+1){for(var v=new RangeSet(p,d,none$1,e.slice(o,f)),y=[],w=0;w<t.length;w++){(u=t[w]).from>=s&&u.to<=s+p&&(t.splice(w--,1),y.push(u.move(-s)))}y.length&&(v=v.update(y.sort(byPos))),e.splice(o,f-o,v),o++,s+=p}else o++,s+=a.length}i=o,r=s},s=0,a=0;s<e.length;)o(s,a),s=i,a=r}var SIDE_A=1,SIDE_B=2,ComparisonSide=function(){function t(t){this.stack=t,this.heap=[],this.active=[],this.activeTo=[],this.points=[],this.tip=null,this.collapsedBy=null,this.collapsedTo=-1}return t.prototype.forward=function(t,e){var n=!1;if(e.set.local.length){var i=new LocalSet(e.offset,e.set.local);addToHeap(this.heap,i),e.set.children.length||(this.tip=i,n=!0)}return iterRangeSet(this.stack,t),n},t.prototype.findActive=function(t,e){for(var n=0;n<this.active.length;n++)if(this.activeTo[n]==t&&this.active[n]==e)return n;return-1},t}(),RangeSetComparison=function(){function t(t,e,n,i,r,o){this.comparator=o,this.a=new ComparisonSide([new IteratedSet(i-e,t)]),this.b=new ComparisonSide([new IteratedSet(0,n)]),this.pos=i,this.end=r,this.forwardIter(SIDE_A|SIDE_B)}return t.prototype.forwardIter=function(t){for(;t>0;){var e=this.a.stack.length?this.a.stack[this.a.stack.length-1]:null,n=this.b.stack.length?this.b.stack[this.b.stack.length-1]:null;if(e&&n&&e.offset==n.offset&&e.set==n.set)iterRangeSet(this.a.stack,this.pos),iterRangeSet(this.b.stack,this.pos);else if(e&&(!n||e.offset<n.offset||e.offset==n.offset&&(1==this.a.stack.length||e.set.length>=n.set.length)))this.a.forward(this.pos,e)&&(t&=~SIDE_A);else{if(!n)break;this.b.forward(this.pos,n)&&(t&=~SIDE_B)}}},t.prototype.run=function(){for(var t=this.a.heap,e=this.b.heap;;)if(t.length&&(!e.length||compareHeapable(t[0],e[0])<0))this.advance(this.a,this.b);else{if(!e.length){this.comparator.comparePoints(this.pos,this.a.points,this.b.points);break}this.advance(this.b,this.a)}},t.prototype.advancePos=function(t){t>this.end&&(t=this.end),t<=this.pos||(this.handlePoints(),this.comparator.compareRange(this.pos,t,this.a.active,this.b.active),this.pos=t)},t.prototype.handlePoints=function(){(this.a.points.length||this.b.points.length)&&(this.comparator.comparePoints(this.pos,this.a.points,this.b.points),this.a.points.length=this.b.points.length=0)},t.prototype.advance=function(t,e){var n=takeFromHeap(t.heap);if(n instanceof LocalSet){if((o=n.ranges[n.index++]).from+n.offset>this.end)return t.heap.length=0,void(this.pos=this.end);if(o.from<o.to&&o.to+n.offset>this.pos){if(this.advancePos(o.from+n.offset),o.value.collapsed){t.collapsedBy=o.value,t.collapsedTo=Math.max(t.collapsedTo,o.to+n.offset);var i=Math.min(this.a.collapsedTo,this.b.collapsedTo);i>this.pos&&(this.handlePoints(),this.comparator.compareCollapsed(this.pos,i,this.a.collapsedBy,this.b.collapsedBy),this.pos=i)}this.addActiveRange(Math.min(this.end,o.to+n.offset),o.value,t,e)}else if(o.from==o.to){this.advancePos(o.from+n.offset),(r=e.points.indexOf(o.value))>-1?remove(e.points,r):t.points.push(o.value)}n.index<n.ranges.length?addToHeap(t.heap,n):n==this.a.tip?this.forwardIter(SIDE_A):n==this.b.tip&&this.forwardIter(SIDE_B)}else{var r,o=n;this.advancePos(o.to),(r=t.findActive(o.to,o.value))>-1&&(remove(t.active,r),remove(t.activeTo,r))}},t.prototype.addActiveRange=function(t,e,n,i){var r=i.findActive(t,e);r>-1?(remove(i.active,r),remove(i.activeTo,r)):(n.active.push(e),n.activeTo.push(t),addToHeap(n.heap,new Range(this.pos,t,e)))},t}();function remove(t,e){var n=t.pop();e!=t.length&&(t[e]=n)}function touchesChanges(t,e,n){for(var i=1,r=0,o=n;r<o.length;r++){var s=o[r];s.to>=t&&s.from<=e&&(s.from<t&&s.to>e?i=2:1==i&&(i=0));var a=s.length-(s.to-s.from);t>s.from&&(t+=a),e>s.to&&(e+=a)}return i}var WidgetType=function(){function t(t){this.value=t}return t.prototype.eq=function(t){return this.value===t},t.prototype.compare=function(t){return this==t||this.constructor==t.constructor&&this.eq(t.value)},Object.defineProperty(t.prototype,"estimatedHeight",{get:function(){return-1},enumerable:!0,configurable:!0}),t.prototype.ignoreEvent=function(t){return!0},t}(),Decoration=function(){function t(t,e,n){this.bias=t,this.widget=e,this.spec=n}return t.range=function(t,e,n){if(t>=e)throw new RangeError("Range decorations may not be empty");return new Range(t,e,new RangeDecoration(n))},t.widget=function(t,e){return new Range(t,t,new WidgetDecoration(e))},t.line=function(t,e){return new Range(t,t,new LineDecoration(e))},t.set=function(t){return RangeSet.of(t)},t.none=RangeSet.empty,t}(),BIG_BIAS=2e9,RangeDecoration=function(t){function e(e){var n=t.call(this,!0===e.inclusiveStart?-BIG_BIAS:BIG_BIAS,e.collapsed instanceof WidgetType?e.collapsed:null,e)||this;return n.spec=e,n.endBias=1==e.inclusiveEnd?BIG_BIAS:-BIG_BIAS,n.collapsed=!!e.collapsed,n}return __extends(e,t),e.prototype.map=function(t,e,n){var i=t.mapPos(e,this.bias,!0),r=t.mapPos(n,this.endBias,!0);if(i<0){if(r<0)return null;i=this.bias>=0?-(i+1):t.mapPos(e,1)}else r<0&&(r=this.endBias<0?-(r+1):t.mapPos(n,-1));return i<r?new Range(i,r,this):null},e.prototype.sameEffect=function(t){return this==t||this.spec.tagName==t.spec.tagName&&this.spec.class==t.spec.class&&this.collapsed==t.collapsed&&widgetsEq(this.widget,t.widget)&&attrsEq(this.spec.attributes,t.spec.attributes)},e}(Decoration),WidgetDecoration=function(t){function e(e){var n=t.call(this,e.side||0,e.widget||null,e)||this;return n.spec=e,n}return __extends(e,t),e.prototype.map=function(t,e){return(e=t.mapPos(e,this.bias,!0))<0?null:new Range(e,e,this)},e.prototype.sameEffect=function(t){return t instanceof e&&widgetsEq(this.widget,t.widget)&&this.bias==t.bias},e}(Decoration),LineDecoration=function(t){function e(e){return t.call(this,-BIG_BIAS,e.widget||null,e)||this}return __extends(e,t),e.prototype.map=function(t,e){for(var n=0,i=t.changes;n<i.length;n++){var r=i[n];if(r.from<=e-1&&r.to>=e)return null;r.from<e&&(e+=r.length-(r.to-r.from))}return new Range(e,e,this)},e.prototype.sameEffect=function(t){return t instanceof e&&attrsEq(this.spec.attributes,t.spec.attributes)&&widgetsEq(this.widget,t.widget)&&this.side==t.side},Object.defineProperty(e.prototype,"side",{get:function(){return this.spec.side||0},enumerable:!0,configurable:!0}),e}(Decoration);function attrsEq(t,e){if(t==e)return!0;if(!t||!e)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!=i.length)return!1;for(var r=0,o=n;r<o.length;r++){var s=o[r];if(-1==i.indexOf(s)||t[s]!==e[s])return!1}return!0}function widgetsEq(t,e){return t==e||!!(t&&e&&t.compare(e))}function compareSets(t,e){if(t.length!=e.length)return!1;t:for(var n=0,i=t;n<i.length;n++){for(var r=i[n],o=0,s=e;o<s.length;o++){var a=s[o];if(r.sameEffect(a))continue t}return!1}return!0}var MIN_RANGE_GAP=4;function addRange(t,e,n){n[n.length-1]+MIN_RANGE_GAP>t?n[n.length-1]=e:n.push(t,e)}function joinRanges(t,e){if(0==t.length)return e;if(0==e.length)return t;for(var n=[],i=0,r=0;;)if(i<t.length&&(r==e.length||t[i]<e[r]))addRange(t[i++],t[i++],n);else{if(!(r<e.length))break;addRange(e[r++],e[r++],n)}return n}var Changes=function(){return function(){this.content=[],this.height=[]}}(),DecorationComparator=function(){function t(){this.changes=new Changes}return t.prototype.compareRange=function(t,e,n,i){compareSets(n,i)||addRange(t,e,this.changes.content)},t.prototype.compareCollapsed=function(t,e,n,i){widgetsEq(n.widget,i.widget)||(addRange(t,e,this.changes.content),addRange(t,e,this.changes.height))},t.prototype.comparePoints=function(t,e,n){compareSets(e,n)||(addRange(t,t,this.changes.content),(e.some(function(t){return!!(t.widget&&t.widget.estimatedHeight>-1)})||n.some(function(t){return!!(t.widget&&t.widget.estimatedHeight>-1)}))&&addRange(t,t,this.changes.height))},t}();function findChangedRanges(t,e,n,i){var r=new DecorationComparator;return t.compare(e,n,r,i.length),r.changes}var HeightDecoScanner=function(){function t(){this.ranges=[],this.pos=0}return t.prototype.advance=function(t,e){this.pos=t},t.prototype.advanceCollapsed=function(t){addRange(this.pos,t,this.ranges),this.pos=t},t.prototype.point=function(t){addRange(this.pos,this.pos,this.ranges)},t.prototype.ignoreRange=function(t){return!0},t.prototype.ignorePoint=function(t){return!t.widget},t}();function heightRelevantDecorations(t,e){for(var n=new HeightDecoScanner,i=0,r=e;i<r.length;i++){var o=r[i],s=o.fromB,a=o.toB;s<a&&(n.pos=s,RangeSet.iterateSpans(t,s,a,n))}return n.ranges}var none$2=[],InlineView=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"children",{get:function(){return none$2},enumerable:!0,configurable:!0}),e.prototype.finish=function(t){},e.prototype.cut=function(t,e){},e.prototype.getSide=function(){return 0},e.appendInline=function(t,e){var n=0;if(e.length&&t.length){var i=t[t.length-1];i.merge(e[0],i.length)&&n++}for(;n<e.length;n++)t.push(e[n]);return t},e}(ContentView),MAX_JOIN_LEN=256,TextView=function(t){function e(e,n,i,r){var o=t.call(this,null,null)||this;return o.text=e,o.tagName=n,o.attrs=r,o.textDOM=null,o.class=i,o}return __extends(e,t),e.prototype.finish=function(t){if(this.setParent(t),!this.dom){this.textDOM=document.createTextNode(this.text);var e=this.tagName||(this.attrs||this.class?"span":null);if(e){if(this.dom=document.createElement(e),this.dom.appendChild(this.textDOM),this.class&&(this.dom.className=this.class),this.attrs)for(var n in this.attrs)this.dom.setAttribute(n,this.attrs[n])}else this.dom=this.textDOM;this.markDirty(),this.dom.cmView=this}},Object.defineProperty(e.prototype,"length",{get:function(){return this.text.length},enumerable:!0,configurable:!0}),e.prototype.sync=function(){if(2&this.dirty){this.textDOM.nodeValue!=this.text&&(this.textDOM.nodeValue=this.text);var t=this.dom;if(this.textDOM!=t&&(this.dom.firstChild!=this.textDOM||t.lastChild!=this.textDOM)){for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(this.textDOM)}}this.dirty=0},e.prototype.merge=function(t,n,i){return void 0===n&&(n=0),void 0===i&&(i=this.length),!(!(t instanceof e&&t.tagName==this.tagName&&t.class==this.class&&attrsEq(t.attrs,this.attrs))||this.length-(i-n)+t.length>MAX_JOIN_LEN)&&(this.text=this.text.slice(0,n)+t.text+this.text.slice(i),this.markDirty(),!0)},e.prototype.cut=function(t,e){void 0===e&&(e=this.length),this.text=this.text.slice(0,t)+this.text.slice(e),this.markDirty()},e.prototype.slice=function(t,n){return void 0===n&&(n=this.length),new e(this.text.slice(t,n),this.tagName,this.class,this.attrs)},e.prototype.localPosFromDOM=function(t,e){return t==this.textDOM?e:e?this.text.length:0},e.prototype.domFromPos=function(t){return{node:this.textDOM,offset:t}},e.prototype.domBoundsAround=function(t,e,n){return{from:n,to:n+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}},e.prototype.coordsAt=function(t){var e=document.createRange();if(browser.chrome||browser.gecko)return e.setEnd(this.textDOM,t),e.setStart(this.textDOM,t),e.getBoundingClientRect();var n=0==t?1:-1;e.setEnd(this.textDOM,t+(n>0?1:0)),e.setStart(this.textDOM,t-(n<0?1:0));var i=e.getBoundingClientRect(),r=n<0?i.right:i.left;return{left:r,right:r,top:i.top,bottom:i.bottom}},e}(InlineView),WidgetView=function(t){function e(e,n,i){var r=t.call(this,null,null)||this;return r.length=e,r.widget=n,r.side=i,r}return __extends(e,t),e.prototype.finish=function(t){this.setParent(t),this.dom||(this.dom=this.widget?this.widget.toDOM():document.createElement("span"),this.dom.contentEditable="false",this.dom.cmView=this),this.markDirty()},e.prototype.cut=function(t,e){void 0===e&&(e=this.length),this.length-=e-t},e.prototype.slice=function(t,n){return void 0===n&&(n=this.length),new e(n-t,this.widget,this.side)},e.prototype.sync=function(){this.dirty=0},e.prototype.getSide=function(){return this.side},e.prototype.merge=function(t,n,i){return void 0===n&&(n=0),void 0===i&&(i=this.length),t instanceof e&&!this.widget&&!t.widget&&(this.length=n+t.length+(this.length-i),!0)},e.prototype.ignoreMutation=function(){return!0},e.prototype.ignoreEvent=function(t){return!!this.widget&&this.widget.ignoreEvent(t)},Object.defineProperty(e.prototype,"overrideDOMText",{get:function(){if(0==this.length)return[""];for(var t=this;t.parent;)t=t.parent;var e=t.text,n=this.posAtStart;return e?e.sliceLines(n,n+this.length):[""]},enumerable:!0,configurable:!0}),e.prototype.domBoundsAround=function(){return null},e.prototype.coordsAt=function(t){for(var e=this.dom.getClientRects(),n=t>0?e.length-1:0;;n+=t>0?-1:1){var i=e[n];if(t>0?0==n:n==e.length-1||i.top<i.bottom)return e[n]}return null},e}(InlineView),LineContent$1=function(){function t(t){void 0===t&&(t=!0),this.atStart=t,this.elements=[],this.attrs=null,this.widgets=none$2}return t.prototype.add=function(t){this.elements.push(t),this.atStart&&t instanceof TextView&&(this.atStart=!1)},t.prototype.addLineDeco=function(t){var e=t.spec.attributes;if(e)for(var n in this.attrs||(this.attrs={}),e)"class"==n&&Object.prototype.hasOwnProperty.call(this.attrs,"class")?this.attrs.class+=" "+e.class:"style"==n&&Object.prototype.hasOwnProperty.call(this.attrs,"style")?this.attrs.style+=";"+e.style:this.attrs[n]=e[n];if(t.widget){this.widgets==none$2&&(this.widgets=[]);for(var i=0;i<this.widgets.length&&this.widgets[i].side<=t.side;)i++;this.widgets.splice(i,0,new LineWidget(t.widget,t.side))}},t}(),InlineBuilder=function(){function t(t,e){this.pos=e,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=e,this.lines=[new LineContent$1(t.lineAt(e).start==e)]}return t.prototype.buildText=function(t,e,n,i,r){for(;t>0;){if(this.textOff==this.text.length){var o=this.cursor.next(this.skip),s=o.value,a=o.lineBreak,h=o.done;if(this.skip=0,h)throw new Error("Ran out of text content when drawing inline views");if(a){this.lines.push(new LineContent$1),t--;continue}this.text=s,this.textOff=0}var l=Math.min(this.text.length-this.textOff,t);this.curLine.add(new TextView(this.text.slice(this.textOff,this.textOff+l),e,n,i)),t-=l,this.textOff+=l}},t.prototype.advance=function(t,e){if(!(t<=this.pos)){for(var n=null,i=null,r=null,o=0,s=e;o<s.length;o++){var a=s[o].spec;if(a.tagName&&(n=a.tagName),a.class&&(i=i?i+" "+a.class:a.class),a.attributes)for(var h in a.attributes){var l=a.attributes[h];null!=l&&("class"==h?i=i?i+" "+l:l:(r||(r={}),"style"==h&&r.style&&(l=r.style+";"+l),r[h]=l))}}this.buildText(t-this.pos,n,i,r,e),this.pos=t}},t.prototype.advanceCollapsed=function(t,e){if(!(t<=this.pos)){var n=this.curLine,i=new WidgetView(t-this.pos,e.widget,0);n.elements.length&&n.elements[n.elements.length-1].merge(i)||n.add(i);var r=t-this.pos;this.textOff+r<=this.text.length?this.textOff+=r:(this.skip+=r-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=t}},t.prototype.point=function(t){t instanceof WidgetDecoration?this.curLine.add(new WidgetView(0,t.widget,t.bias)):this.curLine.atStart&&this.curLine.addLineDeco(t)},Object.defineProperty(t.prototype,"curLine",{get:function(){return this.lines[this.lines.length-1]},enumerable:!0,configurable:!0}),t.prototype.ignoreRange=function(t){return!1},t.prototype.ignorePoint=function(t){return!1},t.build=function(e,n,i,r){var o=new t(e,n);return RangeSet.iterateSpans(r,n,i,o),o.lines},t}(),LineView=function(t){function e(e,n,i){var r=t.call(this,e,document.createElement("div"))||this;return r.widgets=none$3,r.prevAttrs=void 0,r.attrs=null,r.length=0,r.children=[],n&&r.update(0,0,n,i),r.markDirty(),r}return __extends(e,t),e.prototype.setDeco=function(t){attrsEq(this.attrs,t.attrs)||(this.prevAttrs=this.attrs,this.attrs=t.attrs,this.markDirty());for(var e=0,n=0;;){var i=e==this.widgets.length?null:this.widgets[e],r=n==t.widgets.length?null:t.widgets[n];if(!i&&!r)break;i&&r&&i.eq(r)?(e++,n++):!i||r&&r.side<=i.side?(this.widgets==none$3&&(this.widgets=[]),this.widgets.splice(e++,0,r.finish()),this.parent.markDirty(),n++):(this.widgets.splice(e,1),this.parent.markDirty())}},e.prototype.update=function(t,e,n,i){void 0===e&&(e=this.length),0==t&&this.setDeco(n);for(var r=i?InlineView.appendInline(n.elements,i):n.elements,o=new ChildCursor(this.children,this.length),s=o.findPos(e,1),a=s.i,h=s.off,l=o.findPos(t,-1),c=l.i,u=l.off,f=t-e,d=0,p=r;d<p.length;d++){f+=p[d].length}if(this.length+=f,c==a&&u){var g=this.children[c];if(1==r.length&&g.merge(r[0],u,h))return;if(0==r.length)return g.cut(u,h);InlineView.appendInline(r,[g.slice(h)]),a++,h=0}if(h){var m=this.children[a];r.length&&m.merge(r[r.length-1],0,h)?r.pop():m.cut(0,h)}else a<this.children.length&&r.length&&this.children[a].merge(r[r.length-1],0,0)&&r.pop();if(u){g=this.children[c];r.length&&g.merge(r[0],u)?r.shift():g.cut(u),c++}else c&&r.length&&this.children[c-1].merge(r[0],this.children[c-1].length)&&r.shift();for(;c<a&&r.length&&this.children[a-1].merge(r[r.length-1]);)r.pop(),a--;for(;c<a&&r.length&&this.children[c].merge(r[0]);)r.shift(),c++;if(r.length||c!=a){for(var v=0,y=r;v<y.length;v++){y[v].finish(this)}this.replaceChildren(c,a,r)}},e.prototype.detachTail=function(t){var e=[];if(0==this.length)return e;var n=new ChildCursor(this.children,this.length).findPos(t),i=n.i,r=n.off;if(r>0){var o=this.children[i];e.push(o.slice(r)),o.cut(r),i++}if(i<this.children.length){for(var s=i;s<this.children.length;s++)e.push(this.children[s]);this.replaceChildren(i,this.children.length)}return this.length=t,e},e.prototype.domFromPos=function(t){var e=new ChildCursor(this.children,this.length).findPos(t),n=e.i,i=e.off;if(i){var r=this.children[n];if(r instanceof TextView)return{node:r.textDOM,offset:i}}for(;n>0&&(this.children[n-1].getSide()>0||this.children[n-1].dom.parentNode!=this.dom);)n--;return{node:this.dom,offset:n?domIndex(this.children[n-1].dom)+1:0}},e.prototype.syncInto=function(t,e){for(var n=0,i=!1;;n++){var r=n==this.widgets.length?null:this.widgets[n];if(i||r&&!(r.side>0)||(i=!0,e=syncNodeInto(t,e,this.dom)),!r)break;e=syncNodeInto(t,e,r.dom)}return e},e.prototype.sync=function(){t.prototype.sync.call(this),void 0!==this.prevAttrs&&(removeAttrs(this.dom,this.prevAttrs),setAttrs(this.dom,this.attrs),this.prevAttrs=void 0);var e=this.dom.lastChild;if(!e||"BR"==e.nodeName){var n=document.createElement("BR");n.cmIgnore=!0,this.dom.appendChild(n)}},e.prototype.measureTextSize=function(){if(0==this.children.length||this.length>20)return null;for(var t=0,e=0,n=this.children;e<n.length;e++){var i=n[e];if(!(i instanceof TextView))return null;var r=clientRectsFor(i.dom);if(1!=r.length)return null;t+=r[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length}},e.prototype.coordsAt=function(e){return 0==this.length?this.dom.lastChild.getBoundingClientRect():t.prototype.coordsAt.call(this,e)},e.prototype.ignoreMutation=function(t){return!this.dom.contains(1==t.target.nodeType?t.target:t.target.parentNode)},e.prototype.ignoreEvent=function(t){if(0==this.widgets.length||this.dom.contains(t.target))return!1;for(var e=0,n=this.widgets;e<n.length;e++){var i=n[e];if(i.dom.contains(t.target))return i.widget.ignoreEvent(t)}return!0},e}(ContentView),LineWidget=function(){function t(t,e){this.widget=t,this.side=e,this.dom=null}return t.prototype.eq=function(t){return this.widget.compare(t.widget)&&this.side==t.side},t.prototype.finish=function(){return this.dom=this.widget.toDOM(),this.dom.cmIgnore=!0,this},t}(),none$3=[];function setAttrs(t,e){if(e)for(var n in e)t.setAttribute(n,e[n])}function removeAttrs(t,e){if(e)for(var n in e)t.removeAttribute(n)}function visiblePixelRange(t,e){for(var n=t.getBoundingClientRect(),i=Math.max(0,Math.min(innerHeight,n.top)),r=Math.max(0,Math.min(innerHeight,n.bottom)),o=t.parentNode;o;)if(1==o.nodeType){if(o.scrollHeight>o.clientHeight){var s=o.getBoundingClientRect();i=Math.min(s.bottom,Math.max(s.top,i)),r=Math.min(s.bottom,Math.max(s.top,r))}o=o.parentNode}else{if(11!=o.nodeType)break;o=o.host}return{top:i-(n.top+e),bottom:r-(n.top+e)}}var VIEWPORT_MARGIN=1e3,MIN_COVER_MARGIN=10,MAX_COVER_MARGIN=VIEWPORT_MARGIN/4,ViewportState=function(){function t(){this.top=0,this.bottom=0}return t.prototype.updateFromDOM=function(t,e){var n=visiblePixelRange(t,e),i=n.top,r=n.bottom,o=i-this.top,s=r-this.bottom,a=0;return o>0&&s>0?a=Math.max(o,s):o<0&&s<0&&(a=Math.min(o,s)),this.top=i,this.bottom=r,a},t.prototype.coverEverything=function(){this.top=-2e9,this.bottom=2e9},t.prototype.getViewport=function(t,e,n,i){var r=.5-Math.max(-.5,Math.min(.5,n/VIEWPORT_MARGIN/2)),o=new Viewport(e.lineAt(this.top-r*VIEWPORT_MARGIN,t).start,e.lineAt(this.bottom+(1-r)*VIEWPORT_MARGIN,t).end);if(i>-1)if(i<o.from){var s=e.heightAt(i,t,-1);o=new Viewport(e.lineAt(s-VIEWPORT_MARGIN/2,t).start,e.lineAt(s+(this.bottom-this.top)+VIEWPORT_MARGIN/2,t).end)}else if(i>o.to){var a=e.heightAt(i,t,1);o=new Viewport(e.lineAt(a-(this.bottom-this.top)-VIEWPORT_MARGIN/2,t).start,e.lineAt(a+VIEWPORT_MARGIN/2,t).end)}return o},t.prototype.coveredBy=function(t,e,n,i){void 0===i&&(i=0);var r=n.heightAt(e.from,t,-1),o=n.heightAt(e.to,t,1);return(0==e.from||r<=this.top-Math.max(MIN_COVER_MARGIN,Math.min(-i,MAX_COVER_MARGIN)))&&(e.to==t.length||o>=this.bottom+Math.max(MIN_COVER_MARGIN,Math.min(i,MAX_COVER_MARGIN)))},t}(),Viewport=function(){function t(t,e){this.from=t,this.to=e}return t.prototype.clip=function(t){return Math.max(this.from,Math.min(this.to,t))},t.empty=new t(0,0),t}(),observeOptions={childList:!0,characterData:!0,subtree:!0,characterDataOldValue:!0},useCharData=browser.ie&&browser.ie_version<=11,DOMObserver=function(){function t(t,e,n){var i=this;this.docView=t,this.onChange=e,this.onScrollChanged=n,this.active=!1,this.ignoreSelection=new DOMSelection,this.charDataQueue=[],this.charDataTimeout=null,this.scrollTargets=[],this.intersection=null,this.intersecting=!0,this.dom=t.dom,this.observer=new MutationObserver(function(t){return i.flush(t)}),useCharData&&(this.onCharData=function(t){i.charDataQueue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),null==i.charDataTimeout&&(i.charDataTimeout=setTimeout(function(){return i.flush()},20))}),this.onSelectionChange=function(){getRoot(i.dom).activeElement==i.dom&&i.flush()},this.start(),this.onScroll=this.onScroll.bind(this),window.addEventListener("scroll",this.onScroll),"function"==typeof IntersectionObserver&&(this.intersection=new IntersectionObserver(function(t){t[t.length-1].intersectionRatio>0!=i.intersecting&&(i.intersecting=!i.intersecting,i.onScroll())},{}),this.intersection.observe(this.dom)),this.listenForScroll()}return t.prototype.onScroll=function(){this.intersecting&&(this.flush(),this.onScrollChanged())},t.prototype.listenForScroll=function(){for(var t=0,e=null,n=this.dom;n;)if(1==n.nodeType)!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==n?t++:e||(e=this.scrollTargets.slice(0,t)),e&&e.push(n),n=n.parentNode;else{if(11!=n.nodeType)break;n=n.host}if(t<this.scrollTargets.length&&!e&&(e=this.scrollTargets.slice(0,t)),e){for(var i=0,r=this.scrollTargets;i<r.length;i++){(n=r[i]).removeEventListener("scroll",this.onScroll)}for(var o=0,s=this.scrollTargets=e;o<s.length;o++){(n=s[o]).addEventListener("scroll",this.onScroll)}}},t.prototype.ignore=function(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}},t.prototype.start=function(){this.active||(this.observer.observe(this.dom,observeOptions),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange),useCharData&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)},t.prototype.stop=function(){this.active&&(this.active=!1,this.observer.disconnect(),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),useCharData&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))},t.prototype.takeCharRecords=function(){var t=this.charDataQueue;return t.length&&(this.charDataQueue=[],clearTimeout(this.charDataTimeout),this.charDataTimeout=null),t},t.prototype.clearSelection=function(){this.ignoreSelection.set(getRoot(this.dom).getSelection())},t.prototype.clear=function(){this.observer.takeRecords(),this.takeCharRecords(),this.clearSelection()},t.prototype.flush=function(t){var e=this;void 0===t&&(t=this.observer.takeRecords()),this.charDataQueue.length&&(t=t.concat(this.takeCharRecords()));var n=!this.ignoreSelection.eq(getRoot(this.dom).getSelection())&&hasSelection(this.dom);if(0!=t.length||n){for(var i=-1,r=-1,o=!1,s=0,a=t;s<a.length;s++){var h=a[s],l=this.readMutation(h);l&&(l.typeOver&&(o=!0),-1==i?(i=l.from,r=l.to):(i=Math.min(l.from,i),r=Math.max(l.to,r)))}(i>-1||n)&&this.onChange(i,r,o)||(this.docView.dirty&&this.ignore(function(){return e.docView.sync()}),this.docView.updateSelection()),this.clearSelection()}},t.prototype.readMutation=function(t){var e=this.docView.nearest(t.target);if(!e||e.ignoreMutation(t))return null;if(e.markDirty(),"childList"==t.type){var n=findChild(e,t.previousSibling||t.target.previousSibling,-1),i=findChild(e,t.nextSibling||t.target.nextSibling,1);return{from:n?e.posAfter(n):e.posAtStart,to:i?e.posBefore(i):e.posAtEnd,typeOver:!1}}return{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}},t.prototype.destroy=function(){this.stop(),this.intersection&&this.intersection.disconnect();for(var t=0,e=this.scrollTargets;t<e.length;t++){e[t].removeEventListener("scroll",this.onScroll)}window.removeEventListener("scroll",this.onScroll)},t}();function findChild(t,e,n){for(;e;){var i=e.cmView;if(i&&i.parent==t)return i;var r=e.parentNode;e=r!=t.dom?r:n>0?e.nextSibling:e.previousSibling}return null}var wrappingWhiteSpace=["pre-wrap","normal","pre-line"],HeightOracle=function(){function t(){this.doc=Text.of([""]),this.lineWrapping=!1,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}return t.prototype.heightForGap=function(t,e){var n=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(n+=Math.ceil((e-t-n*this.lineLength*.5)/this.lineLength)),this.lineHeight*n},t.prototype.heightForLine=function(t){return this.lineWrapping?(1+Math.max(0,Math.ceil((t-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight},t.prototype.setDoc=function(t){return this.doc=t,this},t.prototype.mustRefresh=function(t){for(var e=!1,n=0;n<t.length;n++){var i=t[n];i<0?n++:this.heightSamples[Math.floor(10*i)]||(e=!0,this.heightSamples[Math.floor(10*i)]=!0)}return e},t.prototype.refresh=function(t,e,n,i,r){var o=wrappingWhiteSpace.indexOf(t)>-1,s=Math.round(e)!=Math.round(this.lineHeight)||this.lineWrapping!=o;if(this.lineWrapping=o,this.lineHeight=e,this.charWidth=n,this.lineLength=i,s){this.heightSamples={};for(var a=0;a<r.length;a++){var h=r[a];h<0?a++:this.heightSamples[Math.floor(10*h)]=!0}}return s},t}(),MeasuredHeights=function(){function t(t,e){this.from=t,this.heights=e,this.index=0}return Object.defineProperty(t.prototype,"more",{get:function(){return this.index<this.heights.length},enumerable:!0,configurable:!0}),t}(),LineHeight=function(){function t(t,e,n,i,r){this.start=t,this.end=e,this.top=n,this.height=i,this.line=r}return Object.defineProperty(t.prototype,"bottom",{get:function(){return this.top+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textTop",{get:function(){return this.top+(this.line?lineWidgetHeight(this.line.deco,-2):0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textBottom",{get:function(){return this.bottom-(this.line?lineWidgetHeight(this.line.deco,-1):0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasCollapsedRanges",{get:function(){if(this.line)for(var t=1;t<this.line.deco.length;t+=2)if(this.line.deco[t]<0)return!0;return!1},enumerable:!0,configurable:!0}),t}(),HeightMap=function(){function t(t,e,n){void 0===n&&(n=!0),this.length=t,this.height=e,this.outdated=n}return t.prototype.setHeight=function(t,e){this.height!=e&&(this.height=e,t.heightChanged=!0)},t.prototype.replace=function(e,n,i,r,o,s){var a,h=[];if(this.decomposeLeft(e,h,i[0],r,o),1==i.length)a=h.pop();else{for(var l=1;l<i.length-1;l++)h.push(i[l]);a=i[i.length-1]}return this.decomposeRight(n,h,a,r,s),t.of(h)},t.prototype.applyChanges=function(t,e,n){for(var i=this,r=0,o=0;o<n.length;o++){var s=n[o],a=buildChangedNodes(e,t,s.fromB,s.toB);i=i.replace(s.fromA+r,s.toA+r,a,e,s.fromB,s.toB),r+=s.toB-s.fromB-(s.toA-s.fromA)}return i},t.empty=function(){return new HeightMapLine(0,0)},t.of=function(e){if(1==e.length)return e[0];for(var n=0,i=e.length,r=0,o=0;n<i;)r<o?r+=e[n++].size:o+=e[--i].size;for(;;)if(r>2*o){var s=e[n-1],a=s.left,h=s.right;e.splice(n-1,1,a,h),r-=h.size,o+=h.size}else{if(!(o>2*r))break;var l=e[n];a=l.left,h=l.right;e.splice(n++,1,a,h),o-=a.size,r+=a.size}return new HeightMapBranch(t.of(e.slice(0,n)),t.of(e.slice(n)))},t}(),noDeco=[],HeightMapLine=function(t){function e(e,n,i){void 0===i&&(i=noDeco);var r=t.call(this,e,n)||this;return r.deco=i,r}return __extends(e,t),Object.defineProperty(e.prototype,"size",{get:function(){return 1},enumerable:!0,configurable:!0}),e.prototype.heightAt=function(t,e,n){return n<0?lineWidgetHeight(this.deco,-2):this.height-lineWidgetHeight(this.deco,-1)},e.prototype.lineAt=function(t,e,n){return void 0===n&&(n=0),new LineHeight(n,n+this.length,-t,this.height,this)},e.prototype.lineViewport=function(t,e,n){return void 0===n&&(n=0),new Viewport(n,n+this.length)},e.prototype.replace=function(n,i,r,o,s,a){return 1!=r.length||r[0]instanceof HeightMapGap&&o.doc.lineAt(s).end<a?t.prototype.replace.call(this,n,i,r,o,s,a):(this.deco=offsetDeco(this.deco,n,i,r[0].length),r[0]instanceof e&&(this.deco=insertDeco(this.deco,r[0].deco,n)),this.length+=r[0].length-(i-n),this.outdated=!0,this)},e.prototype.decomposeLeft=function(t,n,i,r,o){if(0==t)n.push(i);else if(i instanceof e)n.push(this.joinLine(t,this.length,i));else{var s=r.doc.lineAt(o).end,a=s<o+i.length,h=t+(a?s-o:i.length);n.push(new e(h,this.height,offsetDeco(this.deco,t,this.length,0))),a&&n.push(new HeightMapGap(s+1,o+i.length,r))}},e.prototype.decomposeRight=function(t,n,i,r,o){if(t==this.length)n.push(i);else if(i instanceof e)n.push(this.joinLine(0,t,i));else{var s=r.doc.lineAt(o).start,a=s>o-i.length;a&&n.push(new HeightMapGap(o-i.length,s-1,r));var h=(a?o-s:i.length)+(this.length-t);n.push(new e(h,this.height,offsetDeco(this.deco,0,t,h-this.length)))}},e.prototype.joinLine=function(t,n,i){var r=insertDeco(offsetDeco(this.deco,t,n,i.length),i.deco,t);return new e(this.length+i.length-(n-t),Math.max(this.height,i.height),r)},e.prototype.updateHeight=function(t,e,n,i){if(void 0===e&&(e=0),void 0===n&&(n=!1),i&&i.from<=e&&i.more){var r=i.heights[i.index++];if(this.deco.length&&this.deco[0]<0||i.more&&i.heights[i.index]<0){var o=i.more&&-2==i.heights[i.index]?i.heights[(i.index+=2)-1]:0,s=i.more&&-1==i.heights[i.index]?i.heights[(i.index+=2)-1]:0;this.deco=setLineWidgetHeight(setLineWidgetHeight(this.deco.slice(),-2,o),-1,s),r+=o+s}this.setHeight(t,r)}else if(n||this.outdated){for(var a=this.length,h=0,l=0,c=1;c<this.deco.length;c+=2){var u=this.deco[c];u<0?a+=u:this.deco[c-1]<0?l+=u:h=Math.max(u,h)}this.setHeight(t,Math.max(t.heightForLine(a),h)+l)}return this.outdated=!1,this},e.prototype.toString=function(){return"line("+this.length+(this.deco.length?":"+this.deco.join(","):"")+")"},e.prototype.forEachLine=function(t,e,n,i,r){r(new LineHeight(n,n+this.length,0,this.height,this))},Object.defineProperty(e.prototype,"hasCollapsedRanges",{get:function(){for(var t=1;t<this.deco.length;t+=2)if(this.deco[t]<0)return!0;return!1},enumerable:!0,configurable:!0}),e}(HeightMap);function offsetDeco(t,e,n,i){for(var r=null,o=i-(n-e),s=0;s<t.length;s+=2){var a=t[s];Math.max(0,a)<e||a>n&&0==o||(r||(r=t.slice(0,s)),a>n&&r.push(a+o,t[s+1]))}return r?r.length?r:noDeco:t}function insertDeco(t,e,n){if(0==e.length)return t;for(var i=[],r=!1,o=0;;o+=2){var s=o==t.length?2e9:t[o];if(!r&&s>n){for(var a=0;a<e.length;a+=2)(0==n||e[a]>=0)&&i.push(e[a]+n,e[a+1]);r=!0}if(2e9==s)return i;i.push(s,t[o+1])}}function lineWidgetHeight(t,e){for(var n=0;n<t.length;n+=2){var i=t[n];if(i>=0)break;if(i==e)return t[n+1]}return 0}function setLineWidgetHeight(t,e,n){for(var i=0;i<t.length;i+=2){var r=t[i];if(r>e)break;if(r==e)return t[i+1]=n,t}return n>0&&t.splice(i,0,e,n),t}var HeightMapGap=function(t){function e(e,n,i){return t.call(this,n-e,i.heightForGap(e,n),!1)||this}return __extends(e,t),Object.defineProperty(e.prototype,"size",{get:function(){return 1},enumerable:!0,configurable:!0}),e.prototype.heightAt=function(t,e,n,i){void 0===i&&(i=0);var r=e.lineAt(i).number,o=e.lineAt(i+this.length).number-r+1;return(e.lineAt(t).number-r+(n>0?1:0))*(this.height/o)},e.prototype.lineAt=function(t,e,n){void 0===n&&(n=0);var i=e.lineAt(n).number,r=e.lineAt(n+this.length).number-i,o=Math.floor(r*Math.max(0,Math.min(1,t/this.height))),s=this.height/(r+1),a=s*o-t,h=e.line(i+o),l=h.start,c=h.end;return new LineHeight(l,c,a,s,null)},e.prototype.lineViewport=function(t,e,n){void 0===n&&(n=0);var i=e.lineAt(t+n),r=i.start,o=i.end;return new Viewport(r,o)},e.prototype.replace=function(n,i,r,o,s,a){if(1!=r.length||!(r[0]instanceof e))return t.prototype.replace.call(this,n,i,r,o,s,a);this.length+=a-s-(i-n);var h=s-n;return this.setHeight(o,o.heightForGap(h,Math.min(o.doc.length,h+this.length))),this},e.prototype.decomposeLeft=function(t,n,i,r,o){var s=o-t;if(i instanceof e)n.push(new e(s,o+i.length,r));else{var a=r.doc.lineAt(o).start;a>s&&n.push(new e(s,a-1,r));var h=offsetDeco(i.deco,0,0,o-a);n.push(new HeightMapLine(o+i.length-a,i.height,h))}},e.prototype.decomposeRight=function(t,n,i,r,o){var s=o+(this.length-t);if(i instanceof e)n.push(new e(o-i.length,s,r));else{var a=r.doc.lineAt(o).end;n.push(new HeightMapLine(i.length+(a-o),i.height,i.deco)),s>a&&n.push(new e(a+1,s,r))}},e.prototype.updateHeight=function(t,n,i,r){void 0===n&&(n=0),void 0===i&&(i=!1);var o=n+this.length;if(r&&r.from<=n+this.length&&r.more){var s=[],a=Math.max(n,r.from);for(r.from>n&&s.push(new e(n,r.from-1,t));a<=o&&r.more;){for(var h=r.heights[r.index++],l=void 0,c=void 0;r.more&&(c=r.heights[r.index])<0;){var u=r.heights[(r.index+=2)-1];h+=u,l=setLineWidgetHeight(l||[],c,u)}var f=t.doc.lineAt(a).length;s.push(new HeightMapLine(f,h,l)),a+=f+1}a<o&&s.push(new e(a,o,t));for(var d=0,p=s;d<p.length;d++){p[d].outdated=!1}return t.heightChanged=!0,HeightMap.of(s)}return(i||this.outdated)&&(this.setHeight(t,t.heightForGap(n,n+this.length)),this.outdated=!1),this},e.prototype.toString=function(){return"gap("+this.length+")"},e.prototype.forEachLine=function(t,e,n,i,r){for(var o=Math.max(t,n),s=Math.min(e,n+this.length);o<=s;){var a=i.doc.lineAt(o).end;r(new LineHeight(o,a,0,i.heightForLine(a-o),null)),o=a+1}},e}(HeightMap),HeightMapBranch=function(t){function e(e,n){var i=t.call(this,e.length+1+n.length,e.height+n.height,e.outdated||n.outdated)||this;return i.left=e,i.right=n,i.size=e.size+n.size,i}return __extends(e,t),e.prototype.heightAt=function(t,e,n,i){void 0===i&&(i=0);var r=i+this.left.length+1;return t<r?this.left.heightAt(t,e,n,i):this.left.height+this.right.heightAt(t,e,n,r)},e.prototype.lineAt=function(t,e,n){void 0===n&&(n=0);var i=t-this.left.height;return i<0?this.left.lineAt(t,e,n):this.right.lineAt(i,e,n+this.left.length+1)},e.prototype.lineViewport=function(t,e,n){void 0===n&&(n=0);var i=this.left.length+1;return t<i?this.left.lineViewport(t,e,n):this.right.lineViewport(t-i,e,n+i)},e.prototype.replace=function(e,n,i,r,o,s){var a=this.left.length+1;return n<a?this.balanced(this.left.replace(e,n,i,r,o,s),this.right):e>=a?this.balanced(this.left,this.right.replace(e-a,n-a,i,r,o,s)):t.prototype.replace.call(this,e,n,i,r,o,s)},e.prototype.decomposeLeft=function(t,e,n,i,r){var o=this.left.length+1;t<o?this.left.decomposeLeft(t,e,n,i,r):(e.push(this.left),this.right.decomposeLeft(t-o,e,n,i,r))},e.prototype.decomposeRight=function(t,e,n,i,r){var o=this.left.length+1;t<o?(this.left.decomposeRight(t,e,n,i,r),e.push(this.right)):this.right.decomposeRight(t-o,e,n,i,r)},e.prototype.balanced=function(t,e){return t.size>2*e.size||e.size>2*t.size?HeightMap.of([t,e]):(this.left=t,this.right=e,this.height=t.height+e.height,this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+1+e.length,this)},e.prototype.updateHeight=function(t,e,n,i){void 0===e&&(e=0),void 0===n&&(n=!1);var r=this.left,o=this.right,s=e+r.length+1,a=null;return i&&i.from<=e+r.length&&i.more?a=r=r.updateHeight(t,e,n,i):r.updateHeight(t,e,n),i&&i.from<=s+o.length&&i.more?a=o=o.updateHeight(t,s,n,i):o.updateHeight(t,s,n),a?this.balanced(r,o):(this.height=this.left.height+this.right.height,this.outdated=!1,this)},e.prototype.toString=function(){return this.left+" "+this.right},e.prototype.forEachLine=function(t,e,n,i,r){var o=n+this.left.length+1;t<o&&this.left.forEachLine(t,e,n,i,r),e>=o&&this.right.forEachLine(t,e,o,i,r)},e}(HeightMap),NodeBuilder=function(){function t(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.curLine=null,this.writtenTo=t}return t.prototype.advance=function(t){t<=this.pos||(this.curLine?(this.lineEnd<0&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).end),t>this.lineEnd?(this.curLine.length+=this.lineEnd-this.pos,this.curLine.updateHeight(this.oracle,this.lineEnd-this.curLine.length),this.curLine=null,this.writtenTo=this.lineEnd+1,this.lineEnd=-1):(this.curLine.length+=t-this.pos,this.writtenTo=t)):this.lineEnd>-1&&t>this.lineEnd&&(this.lineEnd=-1),this.pos=t)},t.prototype.advanceCollapsed=function(t,e){t<=this.pos||(e.widget&&e.widget.estimatedHeight>=0&&this.addDeco(e.widget.estimatedHeight),this.addDeco(this.pos-t),this.curLine&&(this.curLine.length+=t-this.pos,this.writtenTo=t,this.lineEnd<t&&(this.lineEnd=-1)),this.pos=t)},t.prototype.point=function(t){this.addDeco(t.widget.estimatedHeight,t instanceof LineDecoration?t.side>0?-1:-2:void 0)},t.prototype.flushTo=function(t){t>this.writtenTo&&(this.nodes.push(new HeightMapGap(this.writtenTo,t,this.oracle)),this.writtenTo=t)},t.prototype.addDeco=function(t,e){this.curLine||(this.lineStart=Math.max(this.writtenTo,this.oracle.doc.lineAt(this.pos).start),this.flushTo(this.lineStart-1),this.nodes.push(this.curLine=new HeightMapLine(this.pos-this.lineStart,0,[])),this.writtenTo=this.pos),null==e?this.curLine.deco.push(this.pos-this.lineStart,t):setLineWidgetHeight(this.curLine.deco,e,t+lineWidgetHeight(this.curLine.deco,e))},t.prototype.ignoreRange=function(t){return!t.collapsed},t.prototype.ignorePoint=function(t){return!(t.widget&&t.widget.estimatedHeight>0)},t}();function buildChangedNodes(t,e,n,i){var r=new NodeBuilder(n,t);return RangeSet.iterateSpans(e,n,i,r),r.curLine?r.curLine.updateHeight(t,r.pos-r.curLine.length):r.flushTo(r.pos),0==r.nodes.length&&r.nodes.push(new HeightMapGap(0,0,t)),r.nodes}var DocView=function(t){function e(e,n){var i=t.call(this,null,e)||this;return i.callbacks=n,i.children=[new LineView(i)],i.visiblePart=Viewport.empty,i.viewports=[],i.text=Text.of([""]),i.decorations=[],i.selection=EditorSelection.default,i.selectionDirty=null,i.heightMap=HeightMap.empty(),i.heightOracle=new HeightOracle,i.computingViewport=!1,i.layoutCheckScheduled=-1,i.scrollIntoView=-1,i.paddingTop=0,i.paddingBottom=0,i.dirty=2,i.viewportState=new ViewportState,i.observer=new DOMObserver(i,n.onDOMChange,function(){return i.checkLayout()}),i.publicViewport=new EditorViewport(i,0,0),i}return __extends(e,t),Object.defineProperty(e.prototype,"length",{get:function(){return this.text.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"childGap",{get:function(){return 1},enumerable:!0,configurable:!0}),e.prototype.update=function(t,e,n,i){var r=this;void 0===e&&(e=null),void 0===n&&(n=[]),void 0===i&&(i=-1);var o=this.text.length;this.text=t.doc,this.selection=t.selection;var s=e?(1==n.length?n[0].changes:n.reduce(function(t,e){return t.appendSet(e.changes)},ChangeSet.empty)).changedRanges():[new ChangedRange(0,o,0,t.doc.length)];this.heightMap=this.heightMap.applyChanges([],this.heightOracle.setDoc(t.doc),s);var a=this.computeViewport(s,e,n,0,i),h=a.viewport,l=a.contentChanges;0==this.dirty&&0==l.length&&this.selection.primary.from>=this.visiblePart.from&&this.selection.primary.to<=this.visiblePart.to?(this.updateSelection(),i>-1&&this.scrollPosIntoView(i)):(this.updateInner(l,o,h),this.cancelLayoutCheck(),this.callbacks.onUpdateDOM(),i>-1&&(this.scrollIntoView=i),this.layoutCheckScheduled=requestAnimationFrame(function(){return r.checkLayout()}))},e.prototype.updateInner=function(t,e,n){var i=this;this.visiblePart=n;var r=[n],o=this.selection.primary,s=o.head,a=o.anchor;(s<n.from||s>n.to)&&r.push(this.heightMap.lineViewport(s,this.text)),r.some(function(t){var e=t.from,n=t.to;return a>=e&&a<=n})||r.push(this.heightMap.lineViewport(a,this.text)),r.sort(function(t,e){return t.from-e.from});for(var h=findMatchingRanges(r,this.viewports,t),l=this.decorations.filter(function(t){return t.size>0}),c=new ChildCursor(this.children,e,1),u=this.text.length,f=r.length-1;;f--){var d=c.i;c.findPos(f<0?0:h[f].to+1);var p=null;if(c.i<d){var g=this.children[c.i];g instanceof GapView&&(p=g)}var m=f<0?0:r[f].to+1;if(u>=m?(p&&d-c.i==1||(p||(p=new GapView(this)),this.replaceChildren(c.i,d,[p])),p.update(u-m,this.heightAt(u,1)-this.heightAt(m,-1))):d!=c.i&&this.replaceChildren(c.i,d),f<0)break;var v=r[f],y=h[f];d=c.i,y.from==y.to?(this.replaceChildren(c.i,d,[new LineView(this)]),d=c.i+1):c.findPos(y.from),this.updatePart(c.i,d,y,v,t,l),u=v.from-1}this.viewports=r,this.observer.ignore(function(){i.dom.style.height=i.heightMap.height+"px",i.sync(),i.updateSelection(),i.dom.style.height=""})},e.prototype.updatePart=function(t,e,n,i,r,o){for(var s=clipPlan(r,n,i),a=new ChildCursor(this.children,n.to,1,e),h=s.length-1;h>=0;h--){var l=s[h],c=l.fromA,u=l.toA,f=l.fromB,d=l.toB,p=a.findPos(u),g=p.i,m=p.off,v=a.findPos(c),y=v.i,w=v.off;this.updatePartRange(y,w,g,m,InlineBuilder.build(this.text,f,d,o))}},e.prototype.updatePartRange=function(t,e,n,i,r){var o=this.children;if(1==r.length)if(t==n)o[t].update(e,i,r[0]);else{var s=o[n].detachTail(i);o[t].update(e,void 0,r[0],s),this.replaceChildren(t+1,n+1)}else{s=o[n].detachTail(i);o[t].update(e,void 0,r[0]);for(var a=[],h=1;h<r.length;h++)a.push(new LineView(this,r[h],h<r.length-1?void 0:s));this.replaceChildren(t+1,n+1,a)}},e.prototype.updateSelection=function(t){void 0===t&&(t=!1),this.clearSelectionDirty();var e=getRoot(this.dom);if(t||e.activeElement==this.dom){var n=this.selection.primary,i=this.domFromPos(n.anchor),r=this.domFromPos(n.head),o=e.getSelection();isEquivalentPosition(i.node,i.offset,o.anchorNode,o.anchorOffset)&&isEquivalentPosition(r.node,r.offset,o.focusNode,o.focusOffset)||this.observer.ignore(function(){var t;if(o.extend)o.collapse(i.node,i.offset),n.empty||o.extend(r.node,r.offset);else{var e=document.createRange();n.anchor>n.head&&(i=(t=[r,i])[0],r=t[1]),e.setEnd(r.node,r.offset),e.setStart(i.node,i.offset),o.removeAllRanges(),o.addRange(e)}})}},e.prototype.heightAt=function(t,e){return this.heightMap.heightAt(t,this.text,e)+this.paddingTop},e.prototype.lineAtHeight=function(t){return this.heightMap.lineAt(t-this.paddingTop,this.text)},e.prototype.computeViewport=function(t,e,n,i,r){void 0===t&&(t=[]);try{return this.computingViewport=!0,this.computeViewportInner(t,e,n,i,r)}finally{this.computingViewport=!1}},e.prototype.computeViewportInner=function(t,e,n,i,r){void 0===t&&(t=[]);for(var o=0;;o++){var s=this.viewportState.getViewport(this.text,this.heightMap,i,r),a=n&&n.length>0;if(5==o||null==n&&s.from==this.publicViewport._from&&s.to==this.publicViewport._to)return 5==o&&console.warn("Viewport and decorations failed to converge"),{viewport:s,contentChanges:t};this.publicViewport._from=s.from,this.publicViewport._to=s.to;var h=this.text;a?(this.callbacks.onUpdateState(e,n),h=e.doc):this.callbacks.onUpdateViewport();var l=this.callbacks.getDecorations();if(!a&&sameArray(l,this.decorations))return{viewport:s,contentChanges:t};var c=decoChanges(a?t:[],l,this.decorations,h),u=c.content,f=c.height;this.decorations=l;var d=extendWithRanges([],f);a&&(d=extendWithRanges(d,heightRelevantDecorations(l,t))),this.heightMap=this.heightMap.applyChanges(l,this.heightOracle,d),t=extendWithRanges(t,u),n=null}},e.prototype.focus=function(){this.updateSelection(!0)},e.prototype.cancelLayoutCheck=function(){this.layoutCheckScheduled>-1&&(cancelAnimationFrame(this.layoutCheckScheduled),this.layoutCheckScheduled=-1)},e.prototype.forceLayout=function(){this.layoutCheckScheduled>-1&&!this.computingViewport&&this.checkLayout()},e.prototype.checkLayout=function(t){var e;void 0===t&&(t=!1),this.cancelLayoutCheck(),this.measureVerticalPadding();var n=Math.min(this.scrollIntoView,this.text.length);this.scrollIntoView=-1;var i=0;if(t?this.viewportState.coverEverything():i=this.viewportState.updateFromDOM(this.dom,this.paddingTop),!(this.viewportState.top>=this.viewportState.bottom)){var r=this.measureVisibleLineHeights(),o=!1;if(this.heightOracle.mustRefresh(r)){var s=this.measureTextSize(),a=s.lineHeight,h=s.charWidth;o=this.heightOracle.refresh(getComputedStyle(this.dom).whiteSpace,a,h,this.dom.clientWidth/h,r)}n>-1&&this.scrollPosIntoView(n);for(var l=!1,c=0;;c++){this.heightOracle.heightChanged=!1,this.heightMap=this.heightMap.updateHeight(this.heightOracle,0,o,new MeasuredHeights(this.visiblePart.from,r||this.measureVisibleLineHeights()));var u=this.viewportState.coveredBy(this.text,this.visiblePart,this.heightMap,i);if(u&&!this.heightOracle.heightChanged)break;if(l=!0,c>10)throw new Error("Layout failed to converge");var f=this.visiblePart,d=[];u||(f=(e=this.computeViewport([],null,null,i,-1)).viewport,d=e.contentChanges),this.updateInner(d,this.text.length,f),r=null,o=!1,i=0,this.viewportState.updateFromDOM(this.dom,this.paddingTop)}l&&(this.observer.listenForScroll(),this.callbacks.onUpdateDOM())}},e.prototype.scrollPosIntoView=function(t){var e=this.coordsAt(t);e&&scrollRectIntoView(this.dom,e)},e.prototype.nearest=function(t){for(var e=t;e;){var n=e.cmView;if(n)for(var i=n;i;i=i.parent)if(i==this)return n;e=e.parentNode}return null},e.prototype.posFromDOM=function(t,e){var n=this.nearest(t);if(!n)throw new RangeError("Trying to find position for a DOM position outside of the document");return n.localPosFromDOM(t,e)+n.posAtStart},e.prototype.domFromPos=function(t){var e=new ChildCursor(this.children,this.text.length,1).findPos(t),n=e.i,i=e.off;return this.children[n].domFromPos(i)},e.prototype.measureVisibleLineHeights=function(){for(var t=[],e=this.visiblePart,n=e.from,i=e.to,r=0,o=0;r<=i;o++){var s=this.children[o];if(r>=n){t.push(s.dom.getBoundingClientRect().height);for(var a=0,h=0,l=0,c=s.widgets;l<c.length;l++){var u=c[l],f=u.dom.getBoundingClientRect().height;u.side>0?h+=f:a+=f}a&&t.push(-2,a),h&&t.push(-1,h)}r+=s.length+1}return t},e.prototype.measureVerticalPadding=function(){var t=window.getComputedStyle(this.dom);this.paddingTop=parseInt(t.paddingTop)||0,this.paddingBottom=parseInt(t.paddingBottom)||0},e.prototype.measureTextSize=function(){for(var t=this,e=0,n=this.children;e<n.length;e++){var i=n[e];if(i instanceof LineView){var r=i.measureTextSize();if(r)return r}}var o,s,a=document.createElement("div");return a.style.cssText="contain: strict",a.textContent="abc def ghi jkl mno pqr stu",this.observer.ignore(function(){t.dom.appendChild(a);var e=clientRectsFor(a.firstChild)[0];o=a.getBoundingClientRect().height,s=e?e.width/27:7,a.remove()}),{lineHeight:o,charWidth:s}},e.prototype.destroy=function(){cancelAnimationFrame(this.layoutCheckScheduled),this.observer.destroy()},e.prototype.clearSelectionDirty=function(){null!=this.selectionDirty&&(cancelAnimationFrame(this.selectionDirty),this.selectionDirty=null)},e.prototype.setSelectionDirty=function(){var t=this;this.observer.clearSelection(),null==this.selectionDirty&&(this.selectionDirty=requestAnimationFrame(function(){return t.updateSelection()}))},e}(ContentView),noChildren=[],MAX_NODE_HEIGHT=1e7,GapView=function(t){function e(e){var n=t.call(this,e,document.createElement("div"))||this;return n.length=0,n.height=0,n.dom.contentEditable="false",n}return __extends(e,t),Object.defineProperty(e.prototype,"children",{get:function(){return noChildren},enumerable:!0,configurable:!0}),e.prototype.update=function(t,e){this.length=t,e!=this.height&&(this.height=e,this.markDirty())},e.prototype.sync=function(){if(this.dirty){if(this.height<MAX_NODE_HEIGHT)for(this.dom.style.height=this.height+"px";this.dom.firstChild;)this.dom.firstChild.remove();else{for(this.dom.style.height="";this.dom.firstChild;)this.dom.firstChild.remove();for(var t=this.height;t>0;t-=MAX_NODE_HEIGHT){this.dom.appendChild(document.createElement("div")).style.height=Math.min(t,MAX_NODE_HEIGHT)+"px"}}this.dirty=0}},Object.defineProperty(e.prototype,"overrideDOMText",{get:function(){return this.parent?this.parent.text.sliceLines(this.posAtStart,this.posAtEnd):[""]},enumerable:!0,configurable:!0}),e.prototype.domBoundsAround=function(){return null},e}(ContentView);function decoChanges(t,e,n,i){for(var r=[],o=[],s=e.length-1;s>=0;s--){var a=e[s],h=s<n.length?n[s]:Decoration.none;if(0!=a.size||0!=h.size){var l=findChangedRanges(h,a,t,i);r=joinRanges(r,l.content),o=joinRanges(o,l.height)}}return{content:r,height:o}}function extendWithRanges(t,e){for(var n=[],i=0,r=0,o=0,s=0;;i++){for(var a=i==t.length?null:t[i],h=o-s,l=a?a.fromB:2e9;r<e.length&&e[r]<l;){var c=e[r],u=e[r+1],f=Math.max(s,c),d=Math.min(l,u);if(f<=d&&new ChangedRange(f+h,d+h,f,d).addToSet(n),u>l)break;r+=2}if(!a)return n;new ChangedRange(a.fromA,a.toA,a.fromB,a.toB).addToSet(n),o=a.toA,s=a.toB}}function sameArray(t,e){if(t.length!=e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function boundAfter(t,e){return e<t.from?t.from:e<t.to?t.to:2e9+1}function clipPlan(t,e,n){for(var i=[],r=0,o=0,s=0;;s++){for(var a=s<t.length?t[s]:null,h=a?a.fromA:2e9,l=a?a.fromB:2e9;r<h;){var c=Math.min(Math.min(boundAfter(e,r),h)-r,Math.min(boundAfter(n,o),l)-o);if(0==c)break;var u=r+c,f=o+c;(r>=e.to||u<=e.from)!=(o>=n.to||f<=n.from)&&new ChangedRange(e.clip(r),e.clip(u),n.clip(o),n.clip(f)).addToSet(i),r=u,o=f}if(!a||a.fromA>e.to&&a.fromB>n.to)break;(a.toA>=e.from&&a.fromA<=e.to||a.toB>=n.from&&a.fromB<=n.to)&&new ChangedRange(e.clip(a.fromA),e.clip(a.toA),n.clip(a.fromB),n.clip(a.toB)).addToSet(i),r=a.toA,o=a.toB}return i}function mapThroughChanges(t,e,n){for(var i=0,r=0,o=n;r<o.length;r++){var s=o[r];if(t<s.fromA)return t+i;if(t<=s.toA)return e<0?s.fromA:s.toA;i=s.toB-s.toA}return t+i}function findMatchingRanges(t,e,n){var i=0,r=[];t:for(var o=0,s=t;o<s.length;o++){for(var a=s[o],h=i;h<e.length;h++){var l=e[h];if(mapThroughChanges(l.from,1,n)<a.to&&mapThroughChanges(l.to,-1,n)>a.from){r.push(l),i=h+1;continue t}}var c=r.length?r[r.length-1].to:0;r.push(new Viewport(c,c))}return r}var EditorViewport=function(){function t(t,e,n){this.docView=t,this._from=e,this._to=n}return Object.defineProperty(t.prototype,"from",{get:function(){return this._from},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"to",{get:function(){return this._to},enumerable:!0,configurable:!0}),t.prototype.forEachLine=function(t){this.docView.heightMap.forEachLine(this.from,this.to,0,this.docView.heightOracle,t)},t}();function movePos(t,e,n,i,r){void 0===i&&(i="character");var o=t.root.getSelection(),s=LineContext.get(t,e),a="forward"==n||"right"==n?1:-1;if(!o.modify||!s||s.nearViewportEnd(t)||!t.hasFocus()||"word"==i||"line"==i&&(browser.gecko||t.state.selection.ranges.length>1)){if("character"==i)return moveCharacterSimple(e,a,s,t.state.doc);if("lineboundary"==i){if(s)return s.start+(a<0?0:s.line.length);var h=t.state.doc.lineAt(e);return a<0?h.start:h.end}if("line"==i){if(s&&!s.nearViewportEnd(t,a))for(var l=t.docView.coordsAt(e),c=getGoalColumn(t,e,l.left),u=a<0?l.top:l.bottom,f=5;f<50;f+=10){var d=posAtCoords(t,{x:c.column,y:u+f*a},a);if(d<0)break;if(d!=e)return c.pos=d,d}return moveLineByColumn(t.state.doc,t.state.tabSize,e,a)}if("word"==i)return moveWord(t,e,n);throw new RangeError("Invalid move granularity: "+i)}return t.docView.observer.ignore(function(){var a=s.prepareForQuery(t,e),h=t.docView.domFromPos(e),l=(!browser.chrome||0==a.lines.length)&&isEquivalentPosition(h.node,h.offset,o.focusNode,o.focusOffset)&&!1;a.atWidget&&browser.gecko&&"extend"==r&&(r="move"),"move"!=r||l&&o.isCollapsed?"extend"!=r||l||o.extend(h.node,h.offset):o.collapse(h.node,h.offset),o.modify(r,n,i),t.docView.setSelectionDirty();var c=t.docView.posFromDOM(o.focusNode,o.focusOffset);return s.undoQueryPreparation(t,a),c})}function moveLineByColumn(t,e,n,i){for(var r=t.lineAt(n),o=0,s=t.iterRange(r.start,n);!s.next().done;)o=countColumn(s.value,o,e);if(i<0&&0==r.start)return 0;if(i>0&&r.end==t.length)return r.end;var a=t.line(r.number+i),h=a.start,l=0;for(s=t.iterRange(a.start,a.end);l>=o&&!s.next().done;){var c=findColumn(s.value,l,o,e),u=c.offset;l=o-c.leftOver,h+=u}return h}function moveCharacterSimple(t,e,n,i){if(null==n)for(var r=t;;r+=e){if(0==r||r==i.length)return r;if(!isExtendingChar(e<0?i.slice(r-1,r):i.slice(r,r+1))){if(e<0)return r-1;if(r!=t)return r}}var o=n.line.childPos(t-n.start),s=o.i,a=o.off,h=n.line.children;for(r=t;;){if(a==(e<0||s==h.length?0:h[s].length)){if((s+=e)<0||s>=h.length)return Math.max(0,Math.min(i.length,r+(t==r?e:0)));a=e<0?h[s].length:0}var l=h[s];if(l instanceof TextView){if(!isExtendingChar(l.text.charAt(a-(e<0?1:0)))){if(e<0)return r-1;if(r!=t)return r}a+=e,r+=e}else if(l.length>0)return r-a+(e<0?0:l.length)}}function moveWord(t,e,n){for(var i=t.state.doc,r=e,o=0;;o++){var s=movePos(t,r,n,"character","move");if(s==r)return r;if(i.sliceLines(Math.min(s,r),Math.max(s,r)).length>1)return s;var a=SelectionRange.groupAt(t.state,s,s>r?-1:1),h=r<a.from&&r>a.to?r<a.head:a.from!=r&&(a.to==r||s<r);if(r=h?a.from:a.to,o>0||/\S/.test(i.slice(a.from,a.to)))return r;s=Math.max(0,Math.min(i.length,r+(h?-1:1)))}}function getGoalColumn(t,e,n){for(var i=0,r=t.inputState.goalColumns;i<r.length;i++){var o=r[i];if(o.pos==e)return o}var s={pos:0,column:n};return t.inputState.goalColumns.push(s),s}var LineContext=function(){function t(t,e,n){this.line=t,this.start=e,this.index=n}return t.get=function(e,n){for(var i=0,r=0;;i++){var o=e.docView.children[i],s=r+o.length;if(s>=n)return o instanceof LineView?new t(o,r,i):null;r=s+1}},t.prototype.nearViewportEnd=function(t,e){void 0===e&&(e=0);for(var n=0,i=t.docView.viewports;n<i.length;n++){var r=i[n],o=r.from,s=r.to;if(o>0&&o==this.start&&e<=0||s<t.state.doc.length&&s==this.start+this.line.length&&e>=0)return!0}return!1},t.prototype.prepareForQuery=function(t,e){var n=[],i=!1;function r(t){return t instanceof TextView||(i=!0),!(t.length>0)&&(t.dom.remove(),n.indexOf(t.parent)<0&&n.push(t.parent),!0)}var o=this.line.childPos(e-this.start),s=o.i;if(0==o.off){for(var a=s;a<this.line.children.length&&r(this.line.children[a]);a++);for(a=s;a>0&&r(this.line.children[a-1]);a--);}function h(t,e){if(void 0===e&&(e=-1),0!=t.children.length)for(var i=0,r=0;i<=t.children.length;i++){var o=i==t.children.length?null:t.children[i];o&&o instanceof TextView||r==e||0!=i&&t.children[i-1]instanceof TextView||(t.dom.insertBefore(document.createTextNode("​"),o?o.dom:null),n.indexOf(t)<0&&n.push(t)),o&&(r+=o.length)}}return this.index>0&&h(this.line.parent.children[this.index-1]),h(this.line,e-this.start),this.index<this.line.parent.children.length-1&&h(this.line.parent.children[this.index+1]),{lines:n,atWidget:i}},t.prototype.undoQueryPreparation=function(t,e){for(var n=0,i=e.lines;n<i.length;n++){i[n].syncDOMChildren()}},t}();function domPosAtCoords(t,e,n){for(var i,r,o=2e8,s=0,a=n,h=n,l=t.firstChild,c=0;l;l=l.nextSibling,c++)for(var u=clientRectsFor(l),f=0;f<u.length;f++){var d=u[f];if(d.top<=a&&d.bottom>=h){a=Math.max(d.bottom,a),h=Math.min(d.top,h);var p=d.left>e?d.left-e:d.right<e?e-d.right:0;if(p<o){i=l,o=p,r=0==p?e:d.left>e?d.left:d.right,1==l.nodeType&&(s=c+(e>=(d.left+d.right)/2?1:0));continue}}!i&&(e>=d.right&&n>=d.top||e>=d.left&&n>=d.bottom)&&(s=c+1)}return i&&3==i.nodeType?domPosInText(i,r,n):!i||"false"==i.contentEditable||o&&1==i.nodeType?{node:t,offset:s}:domPosAtCoords(i,r,n)}function domPosInText(t,e,n){for(var i=t.nodeValue.length,r=document.createRange(),o=0;o<i;o++){r.setEnd(t,o+1),r.setStart(t,o);for(var s=r.getClientRects(),a=0;a<s.length;a++){var h=s[a];if(h.top!=h.bottom&&(h.left-1<=e&&h.right+1>=e&&h.top-1<=n&&h.bottom+1>=n)){var l=e>=(h.left+h.right)/2,c=l;if(browser.chrome||browser.gecko)r.setEnd(t,o),r.getBoundingClientRect().left==h.right&&(c=!l);return{node:t,offset:o+(c?1:0)}}}}return{node:t,offset:0}}function posAtCoords(t,e,n){var i,r=e.x,o=e.y;void 0===n&&(n=-1);for(var s,a=t.contentDOM.getBoundingClientRect();;){if((s=t.lineAtHeight(o-a.top)).textTop>0){if(n>0)o+=s.textTop+1;else if(s.start>0){o+=s.top-1;continue}}else if(s.textBottom<0)if(n<0)o+=s.textBottom-1;else if(s.end<t.state.doc.length){o+=s.bottom+1;continue}break}var h=s.start;if(h<t.viewport.from)return 0==t.viewport.from?0:-1;if(h>t.viewport.to)return t.viewport.to==t.state.doc.length?t.state.doc.length:-1;r=Math.max(a.left+1,Math.min(a.right-1,r));var l,c=getRoot(t.contentDOM),u=c.elementFromPoint(r,o),f=-1;if(u&&t.contentDOM.contains(u)&&!(t.docView.nearest(u)instanceof WidgetView))if(c.caretPositionFromPoint){var d=c.caretPositionFromPoint(r,o);d&&(l=d.offsetNode,f=d.offset)}else if(c.caretRangeFromPoint){var p=c.caretRangeFromPoint(r,o);p&&(l=p.startContainer,f=p.startOffset)}l||(l=(i=domPosAtCoords(LineContext.get(t,h).line.dom,r,o)).node,f=i.offset);return t.docView.posFromDOM(l,f)}var InputState=function(){function t(t){var e=this;this.lastKeyCode=0,this.lastKeyTime=0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.registeredEvents=[],this.goalColumns=[],this.mouseSelection=null;var n=function(n){var r=handlers[n];t.contentDOM.addEventListener(n,function(i){eventBelongsToEditor(t,i)&&(e.runCustomHandlers(n,t,i)?i.preventDefault():r(t,i))}),i.registeredEvents.push(n)},i=this;for(var r in handlers)n(r);t.contentDOM.addEventListener("keydown",function(e){t.inputState.lastKeyCode=e.keyCode,t.inputState.lastKeyTime=Date.now()}),document.activeElement==t.contentDOM&&t.dom.classList.add("CodeMirror-focused"),this.customHandlers=customHandlers(t);var o=function(n){s.registeredEvents.indexOf(n)<0&&(s.registeredEvents.push(n),t.contentDOM.addEventListener(n,function(i){eventBelongsToEditor(t,i)&&e.runCustomHandlers(n,t,i)&&i.preventDefault()}))},s=this;for(var r in this.customHandlers)o(r)}return t.prototype.setSelectionOrigin=function(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()},t.prototype.runCustomHandlers=function(t,e,n){var i=this.customHandlers[t];if(i)for(var r=0,o=i;r<o.length;r++){if((0,o[r])(e,n)||n.defaultPrevented)return!0}return!1},t.prototype.startMouseSelection=function(t,e,n){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=new MouseSelection(this,t,e,n)},t.prototype.update=function(t){this.mouseSelection&&this.mouseSelection.map(t.reduce(function(t,e){return t.appendSet(e.changes)},ChangeSet.empty)),this.lastKeyCode=this.lastSelectionTime=0},t.prototype.destroy=function(){this.mouseSelection&&this.mouseSelection.destroy()},t}(),MouseSelection=function(){function t(t,e,n,i){this.inputState=t,this.view=e,this.update=i;var r=e.contentDOM.ownerDocument;r.addEventListener("mousemove",this.move=this.move.bind(this)),r.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=n.shiftKey,this.multiple=e.state.multipleSelections&&(browser.mac?n.metaKey:n.ctrlKey),this.dragMove=!(browser.mac?n.altKey:n.ctrlKey),this.startSelection=e.state.selection;var o=this.queryPos(n),s=o.pos,a=o.bias;this.startPos=this.curPos=s,this.startBias=this.curBias=a,this.dragging=!!isInPrimarySelection(e,this.startPos,n)&&null,!1===this.dragging&&(n.preventDefault(),this.select())}return t.prototype.queryPos=function(t){var e=this.view.posAtCoords({x:t.clientX,y:t.clientY}),n=this.view.coordsAtPos(e);return{pos:e,bias:n?n.top>t.clientY?-1:n.bottom<t.clientY?1:n.left>t.clientX?-1:1:1}},t.prototype.move=function(t){if(0==t.buttons)return this.destroy();if(!1===this.dragging){var e=this.queryPos(t),n=e.pos,i=e.bias;n==this.curPos&&i==this.curBias||(this.curPos=n,this.curBias=i,this.select())}},t.prototype.up=function(t){null==this.dragging&&this.select(),this.destroy()},t.prototype.destroy=function(){var t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.inputState.mouseSelection=null},t.prototype.select=function(){var t=this.update(this.view,this.startSelection,this.startPos,this.startBias,this.curPos,this.curBias,this.extend,this.multiple);t.eq(this.view.state.selection)||this.view.dispatch(this.view.state.transaction.setSelection(t).setMeta(MetaSlot.userEvent,"pointer"))},t.prototype.map=function(t){t.length&&(this.startSelection=this.startSelection.map(t),this.startPos=t.mapPos(this.startPos),this.curPos=t.mapPos(this.curPos)),this.dragging&&(this.dragging=this.dragging.map(t))},t}();function isInPrimarySelection(t,e,n){var i=t.state.selection.primary;if(i.empty)return!1;if(e<i.from||e>i.to)return!1;if(e>i.from&&e<i.to)return!0;var r=t.root.getSelection();if(0==r.rangeCount)return!0;for(var o=r.getRangeAt(0).getClientRects(),s=0;s<o.length;s++){var a=o[s];if(a.left<=n.clientX&&a.right>=n.clientX&&a.top<=n.clientY&&a.bottom>=n.clientY)return!0}return!1}function eventBelongsToEditor(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(var n=e.target;n!=t.contentDOM;n=n.parentNode)if(!n||11==n.nodeType||n.cmView&&n.cmView.ignoreEvent(e))return!1;return!0}function customHandlers(t){var e=Object.create(null);return t.someProp("handleDOMEvents",function(t){for(var n in t)(e[n]||(e[n]=[])).push(t[n])}),e}var handlers=Object.create(null),brokenClipboardAPI=browser.ie&&browser.ie_version<15||browser.ios&&browser.webkit_version<604;function capturePaste(t){var e=t.dom.ownerDocument,n=e.body.appendChild(e.createElement("textarea"));n.style.cssText="position: fixed; left: -10000px; top: 10px",n.focus(),setTimeout(function(){t.focus(),e.body.removeChild(n),doPaste(t,n.value)},50)}function doPaste(t,e){t.dispatch(t.state.transaction.replaceSelection(e).setMeta(MetaSlot.userEvent,"paste").scrollIntoView())}function mustCapture(t){var e=(t.ctrlKey?1:0)|(t.metaKey?8:0)|(t.altKey?2:0)|(t.shiftKey?4:0),n=t.keyCode,i=browser.mac&&1==e;return 8==n||i&&72==n||46==n||i&&68==n||27==n||e==(browser.mac?8:1)&&(66==n||73==n||89==n||90==n)}function rangeForClick(t,e,n,i){if(1==i)return new SelectionRange(e);if(2==i)return SelectionRange.groupAt(t.state,e,n);var r=LineContext.get(t,e);if(r)return new SelectionRange(r.start+r.line.length,r.start);var o=t.state.doc.lineAt(e),s=o.start,a=o.end;return new SelectionRange(s,a)}function updateMouseSelection(t){return function(e,n,i,r,o,s,a,h){var l=rangeForClick(e,o,s,t);if(i!=o&&!a){var c=rangeForClick(e,i,r,t);l=l.extend(Math.min(c.from,l.from),Math.max(c.to,l.to))}return a?n.replaceRange(n.primary.extend(l.from,l.to)):h?n.addRange(l):EditorSelection.create([l])}}function captureCopy(t,e){var n=t.dom.ownerDocument,i=n.body.appendChild(n.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.value=e,i.focus(),i.selectionEnd=e.length,i.selectionStart=0,setTimeout(function(){n.body.removeChild(i),t.focus()},50)}handlers.keydown=function(t,e){mustCapture(e)&&e.preventDefault(),t.inputState.setSelectionOrigin("keyboard")},handlers.touchdown=handlers.touchmove=function(t,e){t.inputState.setSelectionOrigin("pointer")},handlers.mousedown=function(t,e){0==e.button&&t.startMouseSelection(e,updateMouseSelection(e.detail))},handlers.dragstart=function(t,e){var n=t.state,i=n.doc,r=n.selection.primary,o=t.inputState.mouseSelection;o&&(o.dragging=r),e.dataTransfer&&(e.dataTransfer.setData("Text",i.slice(r.from,r.to)),e.dataTransfer.effectAllowed="copyMove")},handlers.drop=function(t,e){if(e.dataTransfer){var n=t.posAtCoords({x:e.clientX,y:e.clientY}),i=e.dataTransfer.getData("Text");if(!(n<0)&&i){e.preventDefault();var r=t.state.transaction,o=t.inputState.mouseSelection;o&&o.dragging&&o.dragMove&&(n=(r=r.replace(o.dragging.from,o.dragging.to,"")).changes.mapPos(n));var s=new Change(n,n,t.state.splitLines(i));r=r.change(s).setSelection(EditorSelection.single(n,n+s.length)).setMeta(MetaSlot.userEvent,"drop"),t.focus(),t.dispatch(r)}}},handlers.paste=function(t,e){t.docView.observer.flush();var n=brokenClipboardAPI?null:e.clipboardData,i=n&&n.getData("text/plain");i?(doPaste(t,i),e.preventDefault()):capturePaste(t)},handlers.copy=handlers.cut=function(t,e){var n=t.state.selection.primary;if(!n.empty){var i=brokenClipboardAPI?null:e.clipboardData,r=t.state.joinLines(t.state.doc.sliceLines(n.from,n.to));i?(e.preventDefault(),i.clearData(),i.setData("text/plain",r)):captureCopy(t,r),"cut"==e.type&&t.dispatch(t.state.transaction.replaceSelection([""]).scrollIntoView().setMeta(MetaSlot.userEvent,"cut"))}},handlers.focus=function(t){t.dom.classList.add("CodeMirror-focused")},handlers.blur=function(t){t.dom.classList.remove("CodeMirror-focused")},handlers.beforeprint=function(t){t.docView.checkLayout(!0)};var LINE_SEP="﷚";function applyDOMChange(t,e,n,i){var r,o,s,a=t.state.selection.primary;if(e>-1&&(s=t.docView.domBoundsAround(e,n,0))){var h=s.from,l=s.to,c=selectionPoints(t.contentDOM),u=new DOMReader(c);u.readRange(s.startDOM,s.endDOM),o=selectionFromPoints(c,h);var f=a.from,d=null;8===t.inputState.lastKeyCode&&t.inputState.lastKeyTime>Date.now()-100&&(f=a.to,d="end");var p=findDiff(t.state.doc.slice(h,l,LINE_SEP),u.text,f-h,d);p&&(r=new Change(h+p.from,h+p.toA,u.text.slice(p.from,p.toB).split(LINE_SEP)))}else if(t.hasFocus()){var g=t.root.getSelection(),m=t.docView.posFromDOM(g.focusNode,g.focusOffset),v=selectionCollapsed(g)?m:t.docView.posFromDOM(g.anchorNode,g.anchorOffset);m==a.head&&v==a.anchor||(o=EditorSelection.single(v,m))}if(!r&&!o)return!1;if(!r&&i&&!a.empty&&o&&o.primary.empty&&(r=new Change(a.from,a.to,t.state.doc.sliceLines(a.from,a.to))),r){var y=t.state;if(browser.android&&(r.from==a.from&&r.to==a.to&&1==r.length&&2==r.text.length&&dispatchKey(t,"Enter",10)||r.from==a.from-1&&r.to==a.to&&0==r.length&&dispatchKey(t,"Backspace",8)||r.from==a.from&&r.to==a.to+1&&0==r.length&&dispatchKey(t,"Delete",46)))return t.state!=y;var w=y.transaction;if(r.from>=a.from&&r.to<=a.to&&r.to-r.from>=(a.to-a.from)/3){var b=a.from<r.from?y.doc.slice(a.from,r.from,LINE_SEP):"",S=a.to>r.to?y.doc.slice(r.to,a.to,LINE_SEP):"";w=w.replaceSelection((b+r.text.join(LINE_SEP)+S).split(LINE_SEP))}else w=w.change(r),o&&!w.selection.primary.eq(o.primary)&&(w=w.setSelection(w.selection.replaceRange(o.primary)));return t.dispatch(w.scrollIntoView()),!0}if(o&&!o.primary.eq(a)){w=t.state.transaction.setSelection(o);return t.inputState.lastSelectionTime>Date.now()-50&&(w="keyboard"==t.inputState.lastSelectionOrigin?w.scrollIntoView():w.setMeta(MetaSlot.userEvent,t.inputState.lastSelectionOrigin)),t.dispatch(w),!0}return!1}function findDiff(t,e,n,i){for(var r=Math.min(t.length,e.length),o=0;o<r&&t.charCodeAt(o)==e.charCodeAt(o);)o++;if(o==r&&t.length==e.length)return null;for(var s=t.length,a=e.length;s>0&&a>0&&t.charCodeAt(s-1)==e.charCodeAt(a-1);)s--,a--;"end"==i&&(n-=s+Math.max(0,o-Math.min(s,a))-o);if(s<o&&t.length<e.length)a=(o-=n<=o&&n>=s?o-n:0)+(a-s),s=o;else if(a<o){s=(o-=n<=o&&n>=a?o-n:0)+(s-a),a=o}return{from:o,toA:s,toB:a}}var DOMReader=function(){function t(t){this.points=t,this.text=""}return t.prototype.readRange=function(t,e){if(t){for(var n=t.parentNode,i=t;;){this.findPointBefore(n,i),this.readNode(i);var r=i.nextSibling;if(r==e)break;(isBlockNode(i)||isBlockNode(r)&&"BR"!=i.nodeName)&&(this.text+=LINE_SEP),i=r}this.findPointBefore(n,e)}},t.prototype.readNode=function(t){if(!t.cmIgnore){var e,n=t.cmView,i=n&&n.overrideDOMText;null!=i?e=i.join(LINE_SEP):3==t.nodeType?e=t.nodeValue:"BR"==t.nodeName?e=t.nextSibling?LINE_SEP:"":1==t.nodeType&&this.readRange(t.firstChild,null),null!=e&&(this.findPointIn(t,e.length),this.text+=e)}},t.prototype.findPointBefore=function(t,e){for(var n=0,i=this.points;n<i.length;n++){var r=i[n];r.node==t&&t.childNodes[r.offset]==e&&(r.pos=this.text.length)}},t.prototype.findPointIn=function(t,e){for(var n=0,i=this.points;n<i.length;n++){var r=i[n];r.node==t&&(r.pos=this.text.length+Math.min(r.offset,e))}},t}();function isBlockNode(t){return 1==t.nodeType&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(t.nodeName)}var DOMPoint=function(){return function(t,e){this.node=t,this.offset=e,this.pos=-1}}();function selectionPoints(t){var e=[],n=getRoot(t);if(n.activeElement!=t)return e;var i=n.getSelection(),r=i.anchorNode,o=i.anchorOffset,s=i.focusNode,a=i.focusOffset;return r&&(e.push(new DOMPoint(r,o)),s==r&&a==o||e.push(new DOMPoint(s,a))),e}function selectionFromPoints(t,e){if(0==t.length)return null;var n=t[0].pos,i=2==t.length?t[1].pos:n;return n>-1&&i>-1?EditorSelection.single(n+e,i+e):null}function dispatchKey(t,e,n){var i={key:e,code:e,keyCode:n,which:n,cancelable:!0},r=new KeyboardEvent("keydown",i);t.contentDOM.dispatchEvent(r);var o=new KeyboardEvent("keyup",i);return t.contentDOM.dispatchEvent(o),r.defaultPrevented||o.defaultPrevented}var EditorView=function(){function t(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var r=this;this.pluginViews=[],this.scheduledDecoUpdate=-1,this.updatingState=!1,this.dispatch=e||function(t){return r.updateState([t],t.apply())},this.contentDOM=document.createElement("pre"),this.contentDOM.className="CodeMirror-content",this.contentDOM.style.cssText=contentCSS,this.contentDOM.setAttribute("contenteditable","true"),this.contentDOM.setAttribute("spellcheck","false"),this.dom=document.createElement("div"),this.dom.style.cssText=editorCSS,this.dom.className="CodeMirror",this.dom.appendChild(this.contentDOM),this.docView=new DocView(this.contentDOM,{onDOMChange:function(t,e,n){return applyDOMChange(r,t,e,n)},onUpdateState:function(t,e){for(var n=0,i=r.pluginViews;n<i.length;n++){var o=i[n];o.updateState&&o.updateState(r,t,e)}},onUpdateDOM:function(){for(var t=0,e=r.pluginViews;t<e.length;t++){var n=e[t];n.updateDOM&&n.updateDOM(r)}},onUpdateViewport:function(){for(var t=0,e=r.pluginViews;t<e.length;t++){var n=e[t];n.updateViewport&&n.updateViewport(r)}},getDecorations:function(){return r.pluginViews.map(function(t){return t.decorations||Decoration.none})}}),this.viewport=this.docView.publicViewport,this.setState.apply(this,[t].concat(n))}return Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),t.prototype.setState=function(t){for(var e=this,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];this._state=t,this.withUpdating(function(){setTabSize(e.contentDOM,t.tabSize),e.createPluginViews(n),e.inputState=new InputState(e),e.docView.update(t)})},t.prototype.updateState=function(t,e){var n=this;if(t.length&&t[0].startState!=this._state)throw new RangeError("Trying to update state with a transaction that doesn't start from the current state.");this.withUpdating(function(){var i=n._state;n._state=e,t.some(function(t){return null!=t.getMeta(MetaSlot.changeTabSize)})&&setTabSize(n.contentDOM,e.tabSize),(e.doc!=i.doc||t.some(function(t){return t.selectionSet&&!t.getMeta(MetaSlot.preserveGoalColumn)}))&&(n.inputState.goalColumns.length=0),n.docView.update(e,i,t,t.some(function(t){return t.scrolledIntoView})?e.selection.primary.head:-1),n.inputState.update(t)})},t.prototype.someProp=function(t,e){for(var n=void 0,i=0,r=this.pluginViews;i<r.length;i++){var o=r[i][t];if(null!=o&&null!=(n=e(o)))break}return n},t.prototype.getProp=function(t){for(var e=0,n=this.pluginViews;e<n.length;e++){var i=n[e][t];if(null!=i)return i}},t.prototype.withUpdating=function(t){if(this.updatingState)throw new Error("Recursive calls of EditorView.updateState or EditorView.setState are not allowed");this.updatingState=!0;try{t()}finally{this.updatingState=!1}},t.prototype.createPluginViews=function(t){this.destroyPluginViews();for(var e=0,n=t;e<n.length;e++){var i=n[e];this.pluginViews.push(i)}for(var r=0,o=this.state.plugins;r<o.length;r++){(i=o[r]).view&&this.pluginViews.push(i.view(this))}},t.prototype.destroyPluginViews=function(){for(var t=0,e=this.pluginViews;t<e.length;t++){var n=e[t];n.destroy&&n.destroy()}this.pluginViews.length=0},t.prototype.domAtPos=function(t){return this.docView.domFromPos(t)},t.prototype.heightAtPos=function(t,e){return this.docView.forceLayout(),this.docView.heightAt(t,e?-1:1)},t.prototype.lineAtHeight=function(t){return this.docView.forceLayout(),this.docView.lineAtHeight(t)},Object.defineProperty(t.prototype,"contentHeight",{get:function(){return this.docView.heightMap.height+this.docView.paddingTop+this.docView.paddingBottom},enumerable:!0,configurable:!0}),t.prototype.movePos=function(t,e,n,i){return void 0===n&&(n="character"),void 0===i&&(i="move"),movePos(this,t,e,n,i)},t.prototype.posAtCoords=function(t){return this.docView.forceLayout(),posAtCoords(this,t)},t.prototype.coordsAtPos=function(t){return this.docView.coordsAt(t)},Object.defineProperty(t.prototype,"defaultCharacterWidth",{get:function(){return this.docView.heightOracle.charWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultLineHeight",{get:function(){return this.docView.heightOracle.lineHeight},enumerable:!0,configurable:!0}),t.prototype.decorationUpdate=function(){var t=this;this.scheduledDecoUpdate<0&&(this.scheduledDecoUpdate=requestAnimationFrame(function(){t.scheduledDecoUpdate=-1,t.docView.update(t.state,t.state)}))},t.prototype.startMouseSelection=function(t,e){this.focus(),this.inputState.startMouseSelection(this,t,e)},Object.defineProperty(t.prototype,"root",{get:function(){return getRoot(this.dom)},enumerable:!0,configurable:!0}),t.prototype.hasFocus=function(){return getRoot(this.dom).activeElement==this.contentDOM},t.prototype.focus=function(){this.docView.focus()},t.prototype.destroy=function(){this.destroyPluginViews(),this.inputState.destroy(),this.dom.remove(),this.docView.destroy()},t}();function setTabSize(t,e){t.style.tabSize=t.style.MozTabSize=e}var editorCSS="\nposition: relative;\ndisplay: flex;\nalign-items: flex-start;",contentCSS="\nmargin: 0;\nflex-grow: 2;\nmin-height: 100%;",mac="undefined"!=typeof navigator&&/Mac/.test(navigator.platform);function normalizeKeyName(t){var e,n,i,r,o=t.split(/-(?!$)/),s=o[o.length-1];"Space"==s&&(s=" ");for(var a=0;a<o.length-1;++a){var h=o[a];if(/^(cmd|meta|m)$/i.test(h))r=!0;else if(/^a(lt)?$/i.test(h))e=!0;else if(/^(c|ctrl|control)$/i.test(h))n=!0;else if(/^s(hift)?$/i.test(h))i=!0;else{if(!/^mod$/i.test(h))throw new Error("Unrecognized modifier name: "+h);mac?r=!0:n=!0}}return e&&(s="Alt-"+s),n&&(s="Ctrl-"+s),r&&(s="Meta-"+s),i&&(s="Shift-"+s),s}function normalize(t){var e=Object.create(null);for(var n in t)e[normalizeKeyName(n)]=t[n];return e}function modifiers(t,e,n){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),!1!==n&&e.shiftKey&&(t="Shift-"+t),t}function keymap(t){var e=keydownHandler(t);return new Plugin({view:function(){return{handleDOMEvents:{keydown:e}}}})}function keydownHandler(t){var e=normalize(t);return function(t,n){var i,r=w3cKeyname.keyName(n),o=1==r.length&&" "!=r,s=e[modifiers(r,n,!o)];if(s&&s(t))return!0;if(o&&(n.shiftKey||n.altKey||n.metaKey)&&(i=w3cKeyname.base[n.keyCode])&&i!=r){var a=e[modifiers(i,n,!0)];if(a&&a(t))return!0}return!1}}var Item=function(){function t(t,e,n){void 0===e&&(e=null),void 0===n&&(n=null),this.map=t,this.inverted=e,this.selection=n}return Object.defineProperty(t.prototype,"isChange",{get:function(){return null!=this.inverted},enumerable:!0,configurable:!0}),t}();function updateBranch(t,e,n,i){var r=e+1>n+20?e-n-1:0,o=t.slice(r,e);return o.push(i),o}function isAdjacent(t,e){return!!t&&e.from<=t.mapPos(t.to,1)&&e.to>=t.mapPos(t.from)}function addChanges(t,e,n,i,r,o){if(t.length){var s=t[t.length-1];if(s.selection&&s.isChange==Boolean(n)&&o(s))return n?updateBranch(t,t.length-1,r,new Item(s.map.appendSet(e.desc),n.appendSet(s.inverted),i)):t}return updateBranch(t,t.length,r,new Item(e.desc,n,i))}function popChanges(t,e){for(var n=null,i=t.length-1;;i--){if(i<0)throw new RangeError("popChanges called on empty branch");var r=t[i];if(r.isChange||1==e&&r.selection)break;n=n?r.map.appendSet(n):r.map}var o=t[i],s=t.slice(0,i),a=o.inverted||ChangeSet.empty,h=o.selection;if(n){var l=o.map.length;n=o.map.appendSet(n);for(var c=[],u=0;u<a.length;u++){var f=a.changes[u].map(n.partialMapping(l-u));f&&(n=n.append(f.desc),c.push(f))}s.push(new Item(n)),a=new ChangeSet(c),h=h.map(n)}return{changes:a,branch:s,selection:h}}function nope(){return!1}function eqSelectionShape(t,e){return t.ranges.length==e.ranges.length&&0===t.ranges.filter(function(t,n){return t.empty!=e.ranges[n].empty}).length}var HistoryState=function(){function t(t,e,n,i){void 0===n&&(n=null),void 0===i&&(i=void 0),this.done=t,this.undone=e,this.prevTime=n,this.prevUserEvent=i}return t.prototype.resetTime=function(){return new t(this.done,this.undone)},t.prototype.addChanges=function(e,n,i,r,o,s,a){var h=nope;return null!==this.prevTime&&r-this.prevTime<s&&(n||this.prevUserEvent==o&&"keyboard"==o)&&(h=n?function(t){return isAdjacent(t.map.changes[t.map.length-1],e.changes[0])}:function(t){return eqSelectionShape(t.selection,i)}),new t(addChanges(this.done,e,n,i,a,h),this.undone,r,o)},t.prototype.addMapping=function(e,n){return 0==this.done.length?this:new t(updateBranch(this.done,this.done.length,n,new Item(e)),this.undone)},t.prototype.canPop=function(t,e){for(var n=0,i=0==t?this.done:this.undone;n<i.length;n++){var r=i[n],o=r.isChange,s=r.selection;if(o||1==e&&s)return!0}return!1},t.prototype.pop=function(e,n,i,r){for(var o=popChanges(0==e?this.done:this.undone,n),s=o.changes,a=o.branch,h=o.selection,l=i.selection,c=0,u=s.changes;c<u.length;c++){var f=u[c];i=i.change(f)}i=i.setSelection(h);var d=0==e?this.undone:this.done;return d=addChanges(d,i.changes,i.changes.length>0?i.invertedChanges():null,l,r,nope),{transaction:i,state:new t(0==e?a:d,0==e?d:a)}},t.prototype.eventCount=function(t,e){for(var n=0,i=0,r=0==t?this.done:this.undone;i<r.length;i++){var o=r[i],s=o.isChange,a=o.selection;(s||1==e&&a)&&++n}return n},t.empty=new t([],[]),t}(),historyStateSlot=new MetaSlot("historyState"),closeHistorySlot=new MetaSlot("historyClose"),historyField=new StateField({init:function(t){return HistoryState.empty},apply:function(t,e,n){var i=t.getMeta(historyStateSlot);if(i)return i;if(t.getMeta(closeHistorySlot)&&(e=e.resetTime()),!t.changes.length&&!t.selectionSet)return e;var r=n.getPluginWithField(historyField).config,o=r.newGroupDelay,s=r.minDepth;return!1!==t.getMeta(MetaSlot.addToHistory)?e.addChanges(t.changes,t.changes.length?t.invertedChanges():null,t.startState.selection,t.getMeta(MetaSlot.time),t.getMeta(MetaSlot.userEvent),o,s):e.addMapping(t.changes.desc,s)},debugName:"historyState"});function history(t){var e=void 0===t?{}:t,n=e.minDepth,i=void 0===n?100:n,r=e.newGroupDelay;return new Plugin({state:historyField,config:{minDepth:i,newGroupDelay:void 0===r?500:r}})}function historyCmd(t,e,n,i){var r=n.getField(historyField);if(!r||!r.canPop(t,e))return!1;var o=n.getPluginWithField(historyField).config.minDepth,s=r.pop(t,e,n.transaction,o),a=s.transaction,h=s.state;return i(a.setMeta(historyStateSlot,h)),!0}function undo(t){return historyCmd(0,0,t.state,t.dispatch)}function redo(t){return historyCmd(1,0,t.state,t.dispatch)}function undoSelection(t){return historyCmd(0,1,t.state,t.dispatch)}function redoSelection(t){return historyCmd(1,1,t.state,t.dispatch)}function gutter(t){return void 0===t&&(t={}),new Plugin({view:function(e){return new GutterView(e,t)}})}var GutterView=function(){function t(t,e){this.spaceAbove=0,this.lines=[],this.dom=document.createElement("div"),this.dom.className="CodeMirror-gutter",this.dom.setAttribute("aria-hidden","true"),this.dom.style.cssText="left: 0; box-sizing: border-box; height: 100%; overflow: hidden; flex-shrink: 0;",!1!==e.fixed&&(this.dom.style.position="sticky"),t.dom.insertBefore(this.dom,t.contentDOM),this.formatNumber=e.formatNumber||String,this.lastLine=new GutterLine(1,0,0,0,this.formatNumber),this.lastLine.dom.style.cssText+="visibility: hidden; pointer-events: none",this.dom.appendChild(this.lastLine.dom),this.updateDOM(t)}return t.prototype.updateDOM=function(t){for(var e=9;e<t.state.doc.lines;)e=10*e+9;this.lastLine.update(e,0,0,0,this.formatNumber),this.updateGutter(t)},t.prototype.updateGutter=function(t){var e=this,n=t.heightAtPos(t.viewport.from,!0);n!=this.spaceAbove&&(this.spaceAbove=n,this.dom.style.paddingTop=n+"px");var i=0,r=-1;for(t.viewport.forEachLine(function(n){var o=n.textTop,s=n.height-n.textBottom,a=n.height-o-s;if(r<0&&(r=t.state.doc.lineAt(n.start).number),i==e.lines.length){var h=new GutterLine(r,a,o,s,e.formatNumber);e.lines.push(h),e.dom.appendChild(h.dom)}else e.lines[i].update(r,a,o,s,e.formatNumber);r=n.hasCollapsedRanges?-1:r+1,i++});this.lines.length>i;)this.dom.removeChild(this.lines.pop().dom);this.dom.style.minHeight=t.contentHeight+"px"},t.prototype.destroy=function(){this.dom.remove()},t}(),GutterLine=function(){function t(t,e,n,i,r){this.lineNo=-1,this.height=-1,this.above=-1,this.below=-1,this.dom=document.createElement("div"),this.dom.className="CodeMirror-gutter-element",this.update(t,e,n,i,r)}return t.prototype.update=function(t,e,n,i,r){this.lineNo!=t&&(this.dom.textContent=r(this.lineNo=t)),this.height!=e&&(this.dom.style.height=(this.height=e)+"px"),this.above!=n&&(this.dom.style.marginTop=(this.above=n)+"px"),this.below!=i&&(this.dom.style.marginBottom=(this.below=i)+"px")},t}();function moveSelection(t,e,n){var i=t.state.transaction.mapRanges(function(i){return i.empty||"lineboundary"==n?new SelectionRange(t.movePos(i.head,e,n,"move")):new SelectionRange("left"==e||"backward"==e?i.from:i.to)});return!i.selection.eq(t.state.selection)&&("line"==n&&(i=i.setMeta(MetaSlot.preserveGoalColumn,!0)),t.dispatch(i.scrollIntoView()),!0)}var moveCharLeft=function(t){return moveSelection(t,"left","character")},moveCharRight=function(t){return moveSelection(t,"right","character")},moveWordLeft=function(t){return moveSelection(t,"left","word")},moveWordRight=function(t){return moveSelection(t,"right","word")},moveLineUp=function(t){return moveSelection(t,"backward","line")},moveLineDown=function(t){return moveSelection(t,"forward","line")},moveLineStart=function(t){return moveSelection(t,"backward","lineboundary")},moveLineEnd=function(t){return moveSelection(t,"forward","lineboundary")};function extendSelection(t,e,n){var i=t.state.transaction.mapRanges(function(i){return new SelectionRange(i.anchor,t.movePos(i.head,e,n,"extend"))});return!i.selection.eq(t.state.selection)&&("line"==n&&(i=i.setMeta(MetaSlot.preserveGoalColumn,!0)),t.dispatch(i.scrollIntoView()),!0)}var extendCharLeft=function(t){return extendSelection(t,"left","character")},extendCharRight=function(t){return extendSelection(t,"right","character")},extendWordLeft=function(t){return extendSelection(t,"left","word")},extendWordRight=function(t){return extendSelection(t,"right","word")},extendLineUp=function(t){return extendSelection(t,"backward","line")},extendLineDown=function(t){return extendSelection(t,"forward","line")},extendLineStart=function(t){return extendSelection(t,"backward","lineboundary")},extendLineEnd=function(t){return extendSelection(t,"forward","lineboundary")},selectDocStart=function(t){var e=t.state;return(0,t.dispatch)(e.transaction.setSelection(EditorSelection.single(0)).scrollIntoView()),!0},selectDocEnd=function(t){var e=t.state;return(0,t.dispatch)(e.transaction.setSelection(EditorSelection.single(e.doc.length)).scrollIntoView()),!0},selectAll=function(t){var e=t.state;return(0,t.dispatch)(e.transaction.setSelection(EditorSelection.single(0,e.doc.length))),!0};function deleteText(t,e){var n=t.state.transaction.reduceRanges(function(n,i){var r=i.from,o=i.to;if(r==o){var s=t.movePos(i.head,e,"character","move");r=Math.min(r,s),o=Math.max(o,s)}return r==o?{transaction:n,range:i}:{transaction:n.replace(r,o,""),range:new SelectionRange(r)}});return!!n.docChanged&&(t.dispatch(n.scrollIntoView()),!0)}var deleteCharBackward=function(t){return deleteText(t,"backward")},deleteCharForward=function(t){return deleteText(t,"forward")},pcBaseKeymap={ArrowLeft:moveCharLeft,ArrowRight:moveCharRight,"Shift-ArrowLeft":extendCharLeft,"Shift-ArrowRight":extendCharRight,"Mod-ArrowLeft":moveWordLeft,"Mod-ArrowRight":moveWordRight,"Shift-Mod-ArrowLeft":extendWordLeft,"Shift-Mod-ArrowRight":extendWordRight,ArrowUp:moveLineUp,ArrowDown:moveLineDown,"Shift-ArrowUp":extendLineUp,"Shift-ArrowDown":extendLineDown,Home:moveLineStart,End:moveLineEnd,"Shift-Home":extendLineStart,"Shift-End":extendLineEnd,"Mod-Home":selectDocStart,"Mod-End":selectDocEnd,"Mod-a":selectAll,Backspace:deleteCharBackward,Delete:deleteCharForward},macBaseKeymap={"Control-b":moveCharLeft,"Control-f":moveCharRight,"Shift-Control-b":extendCharLeft,"Shift-Control-f":extendCharRight,"Control-p":moveLineUp,"Control-n":moveLineDown,"Shift-Control-p":extendLineUp,"Shift-Control-n":extendLineDown,"Control-a":moveLineStart,"Control-e":moveLineEnd,"Shift-Control-a":extendLineStart,"Shift-Control-e":extendLineEnd,"Cmd-ArrowUp":selectDocStart,"Cmd-ArrowDown":selectDocEnd,"Control-d":deleteCharForward,"Control-h":deleteCharBackward};for(var key in pcBaseKeymap)macBaseKeymap[key]=pcBaseKeymap[key];var mac$1="undefined"!=typeof navigator?/Mac/.test(navigator.platform):"undefined"!=typeof os&&"darwin"==os.platform(),baseKeymap=mac$1?macBaseKeymap:pcBaseKeymap,matching={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"};function getStyle(t,e){if(t)for(var n,i=t.iter();n=i.next();)if(n.from<=e&&e<n.to)return n.value.spec.class}function findMatchingBracket(t,e,n,i){void 0===i&&(i={});var r=n-1,o=!i.afterCursor&&r>=0&&matching[t.slice(r,r+1)]||matching[t.slice(++r,r+1)];if(!o)return null;var s=">"==o[1]?1:-1;if(i.strict&&s>0!=(r==n))return null;var a=scanForBracket(t,e,r+(s>0?1:0),s,getStyle(e,r)||null,i);return null==a?null:{from:r,to:a?a.pos:null,match:a&&a.ch==o.charAt(0),forward:s>0}}function scanForBracket(t,e,n,i,r,o){for(var s=o.maxScanDistance||1e4,a=o.bracketRegex||/[(){}[\]]/,h=[],l=t.iterRange(n,i>0?t.length:0),c=0;!l.done&&c<=s;){l.next();var u=l.value;i<0&&(c+=u.length);for(var f=n+c*i,d=i>0?0:u.length-1,p=i>0?u.length:-1;d!=p;d+=i){var g=u.charAt(d);if(a.test(g)&&(void 0===r||getStyle(e,f+d)==r))if(">"==matching[g].charAt(1)==i>0)h.push(g);else{if(!h.length)return{pos:f+d,ch:g};h.pop()}}i>0&&(c+=u.length)}return!l.done&&null}function doMatchBrackets(t,e,n){for(var i=[],r=0,o=t.selection.ranges;r<o.length;r++){var s=o[r];if(s.empty){var a=findMatchingBracket(t.doc,e,s.head,n);if(a){var h=a.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";i.push(Decoration.range(a.from,a.from+1,{class:h})),a.to&&i.push(Decoration.range(a.to,a.to+1,{class:h}))}}}return Decoration.set(i)}function matchBrackets(t){return void 0===t&&(t={}),new Plugin({view:function(e){var n=t.decorationsPlugin&&e.state.plugins.filter(function(t){return t.view}).indexOf(t.decorationsPlugin),i=Decoration.none;return{get decorations(){return i},updateState:function(e){var r=null==n?void 0:e.pluginViews[n].decorations;i=doMatchBrackets(e.state,r,t)}}}})}function specialChars(t){return void 0===t&&(t={}),new Plugin({view:function(e){return new SpecialCharHighlighter(e,t)}})}var JOIN_GAP=10,SpecialCharHighlighter=function(){function t(t,e){this.view=t,this.options=e,this.decorations=Decoration.none,this.from=0,this.to=0,this.updateForViewport(),this.specials=e.specialChars||SPECIALS,e.addSpecialChars&&(this.specials=new RegExp(this.specials.source+"|"+e.addSpecialChars.source,"gu"));var n=document.body.style;(this.replaceTabs=null==(n.tabSize||n.MozTabSize))&&(this.specials=new RegExp("\t|"+this.specials.source,"gu"))}return t.prototype.updateState=function(t,e,n){var i=n.reduce(function(t,e){return t.appendSet(e.changes)},ChangeSet.empty);i.length&&(this.decorations=this.decorations.map(i),this.from=i.mapPos(this.from,1),this.to=i.mapPos(this.to,-1),this.closeHoles(i.changedRanges())),this.updateForViewport()},t.prototype.updateViewport=function(){this.updateForViewport()},t.prototype.closeHoles=function(t){for(var e=[],n=this.view.viewport,i=[],r=0;r<t.length;r++){var o=t[r],s=o.fromB,a=o.toB;for(this.replaceTabs&&(a=this.view.state.doc.lineAt(a).end);r<t.length-1&&t[r+1].fromB<a+JOIN_GAP;)a=Math.max(a,t[++r].toB);(s=Math.max(n.from,s))>=(a=Math.min(n.to,a))||(this.getDecorationsFor(s,a,e),i.push(s,a))}e.length&&(this.decorations=this.decorations.update(e,function(t){for(var e=0;e<i.length;e+=2)if(t>=i[e]&&t<i[e+1])return!1;return!0},i[0],i[i.length-1]))},t.prototype.updateForViewport=function(){var t=this.view.viewport;if(this.from!=t.from||this.to!=t.to){var e=[];this.from>=t.to||this.to<=t.from?(this.getDecorationsFor(t.from,t.to,e),this.decorations=Decoration.set(e)):(t.from<this.from&&this.getDecorationsFor(t.from,this.from,e),this.to<t.to&&this.getDecorationsFor(this.to,t.to,e),this.decorations=this.decorations.update(e,function(e,n){return e>=t.from&&n<=t.to})),this.from=t.from,this.to=t.to}},t.prototype.getDecorationsFor=function(t,e,n){for(var i=this.view.state.doc,r=t,o=i.iterRange(t,e),s=void 0;!o.next().done;){if(!o.lineBreak)for(;s=SPECIALS.exec(o.value);){var a=s[0].codePointAt?s[0].codePointAt(0):s[0].charCodeAt(0),h=void 0;if(null!=a){if(9==a){var l=i.lineAt(r+s.index),c=this.view.state.tabSize,u=countColumn(i.slice(l.start,r+s.index),0,c);h=new TabWidget((c-u%c)*this.view.defaultCharacterWidth)}else h=new SpecialCharWidget(this.options,a);n.push(Decoration.range(r+s.index,r+s.index+s[0].length,{collapsed:h}))}}r+=o.value.length}},t}(),SPECIALS=/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b-\u200f\u2028\u2029\ufeff]/gu,NAMES={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8233:"paragraph separator",65279:"zero width no-break space"};function placeHolder(t){return t>=32?null:10==t?"␤":String.fromCharCode(9216+t)}var DEFAULT_PLACEHOLDER="•",SpecialCharWidget=function(t){function e(e,n){var i=t.call(this,n)||this;return i.options=e,i}return __extends(e,t),e.prototype.toDOM=function(){var t=placeHolder(this.value)||DEFAULT_PLACEHOLDER,e="Control character "+(NAMES[this.value]||this.value),n=this.options.render&&this.options.render(this.value,e,t);if(n)return n;var i=document.createElement("span");return i.textContent=t,i.title=e,i.setAttribute("aria-label",e),i.style.color="red",i},e.prototype.ignoreEvent=function(){return!1},e}(WidgetType),TabWidget=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.toDOM=function(){var t=document.createElement("span");return t.textContent="\t",t.className="CodeMirror-tab",t.style.width=this.value+"px",t},e.prototype.ignoreEvent=function(){return!1},e}(WidgetType);function multipleSelections(){return new Plugin({multipleSelections:!0,view:function(t){return new MultipleSelectionView(t)}})}var CursorWidget=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.toDOM=function(){var t=document.createElement("span");return t.className="CodeMirror-secondary-cursor",t},e}(WidgetType),MultipleSelectionView=function(){function t(t){this.decorations=Decoration.none,this.update(t.state),this.rangeConfig={class:"CodeMirror-secondary-selection"}}return t.prototype.updateState=function(t,e){e.doc==t.state.doc&&e.selection.eq(t.state.selection)||this.update(t.state)},t.prototype.update=function(t){var e=t.selection,n=e.ranges,i=e.primaryIndex;if(0!=n.length){for(var r=[],o=0;o<n.length;o++)if(o!=i){var s=n[o];r.push(s.empty?Decoration.widget(s.from,{widget:new CursorWidget(null)}):Decoration.range(n[o].from,n[o].to,this.rangeConfig))}this.decorations=Decoration.set(r)}else this.decorations=Decoration.none},t}();function countColumn$1(t,e,n,i,r){null==e&&-1==(e=t.search(/[^\s\u00a0]/))&&(e=t.length);for(var o=i||0,s=r||0;;){var a=t.indexOf("\t",o);if(a<0||a>=e)return s+(e-o);s+=a-o,s+=n-s%n,o=a+1}}var StringStream=function(){function t(t,e,n){this.string=t,this.tabSize=e,this.lineOracle=n,this.pos=this.start=0,this.string=t,this.tabSize=e||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0,this.lineOracle=n}return t.prototype.eol=function(){return this.pos>=this.string.length},t.prototype.sol=function(){return this.pos==this.lineStart},t.prototype.peek=function(){return this.string.charAt(this.pos)||void 0},t.prototype.next=function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},t.prototype.eat=function(t){var e=this.string.charAt(this.pos);if("string"==typeof t?e==t:e&&(t instanceof RegExp?t.test(e):t(e)))return++this.pos,e},t.prototype.eatWhile=function(t){for(var e=this.pos;this.eat(t););return this.pos>e},t.prototype.eatSpace=function(){for(var t=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>t},t.prototype.skipToEnd=function(){this.pos=this.string.length},t.prototype.skipTo=function(t){var e=this.string.indexOf(t,this.pos);if(e>-1)return this.pos=e,!0},t.prototype.backUp=function(t){this.pos-=t},t.prototype.column=function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=countColumn$1(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?countColumn$1(this.string,this.lineStart,this.tabSize):0)},t.prototype.indentation=function(){return countColumn$1(this.string,null,this.tabSize)-(this.lineStart?countColumn$1(this.string,this.lineStart,this.tabSize):0)},t.prototype.match=function(t,e,n){if("string"==typeof t){var i=function(t){return n?t.toLowerCase():t};return i(this.string.substr(this.pos,t.length))==i(t)?(!1!==e&&(this.pos+=t.length),!0):null}var r=this.string.slice(this.pos).match(t);return r&&r.index>0?null:(r&&!1!==e&&(this.pos+=r[0].length),r)},t.prototype.current=function(){return this.string.slice(this.start,this.pos)},t.prototype.hideFirstChars=function(t,e){this.lineStart+=t;try{return e()}finally{this.lineStart-=t}},t.prototype.lookAhead=function(t){var e=this.lineOracle;return e&&e.lookAhead(t)},t.prototype.baseToken=function(){var t=this.lineOracle;return t&&t.baseToken(this.pos)},t}(),StringStreamCursor=function(){function t(t,e,n){void 0===n&&(n=4),this.offset=e,this.tabSize=n,this.iter=t.iterLines(e),this.curLineEnd=this.offset-1}return t.prototype.next=function(){var t=this.iter.next(),e=t.value;if(t.done)throw new RangeError("Reached end of document");var n=new StringStream(e,this.tabSize,null);return this.offset=this.curLineEnd+1,this.curLineEnd+=e.length+1,n},t}();function readToken(t,e,n){for(var i=0;i<10;i++){var r=t.token(e,n);if(e.pos>e.start)return r}throw new Error("Mode "+t.name+" failed to advance stream.")}function copyState(t,e){if(!0===e)return e;if(t.copyState)return t.copyState(e);var n={};for(var i in e){var r=e[i];r instanceof Array&&(r=r.concat([])),n[i]=r}return n}var CachedState=function(){function t(t,e){this.state=t,this.pos=e}return t.prototype.copy=function(e){return new t(copyState(e,this.state),this.pos)},t}(),MAX_SCAN_DIST=2e4;function cutDecoratedRange(t,e){return!t||e<=t.from?null:{from:t.from,to:Math.min(e,t.to),decorations:t.decorations.filter(function(t){return t.to<=e})}}var StateCache=function(){function t(t,e,n){this.states=t,this.frontier=e,this.lastDecorations=n}return t.prototype.advanceFrontier=function(t,e,n,i,r){var o=this;return this.frontier>=e?Promise.reject():(clearTimeout(this.timeout),new Promise(function(s){var a=function(){var h=+new Date+r;do{var l=Math.min(e,o.frontier+MAX_SCAN_DIST/2);if(o.getState(t,l,n),o.frontier>=e)return s()}while(+new Date<h);o.timeout=setTimeout(a,i)};o.timeout=setTimeout(a,i)}))},t.prototype.calculateDecorations=function(t,e,n,i){for(var r=this.getState(t,e,i),o=new StringStreamCursor(t.doc,e,t.tabSize),s=[],a=[],h=o.next(),l=0;o.offset+h.start<n;)if(h.eol())h=o.next(),++l%5==0&&s.push(new CachedState(copyState(i,r),o.offset));else{var c=readToken(i,h,r);c&&a.push(Decoration.range(o.offset+h.start,o.offset+h.pos,{class:"cm-"+c.replace(/ /g," cm-")})),h.start=h.pos}return this.storeStates(e,n,s),a},t.prototype.getDecorations=function(t,e,n,i){var r=e,o=[];return this.lastDecorations&&(e<this.lastDecorations.from&&(r=Math.min(n,this.lastDecorations.from),o=this.calculateDecorations(t,e,r,i)),r<n&&this.lastDecorations.to>r&&(r=this.lastDecorations.to,o=o.concat(this.lastDecorations.decorations))),r<n&&(o=o.concat(this.calculateDecorations(t,r,n,i))),this.lastDecorations={from:e,to:n,decorations:o},o},t.prototype.storeStates=function(t,e,n){var i,r=this.findIndex(t),o=this.findIndex(e);(i=this.states).splice.apply(i,[r,o-r].concat(n)),t<=this.frontier&&(this.frontier=Math.max(this.frontier,e))},t.prototype.findIndex=function(t){for(var e=0;e<this.states.length&&this.states[e].pos<t;)e++;return e},t.prototype.stateBefore=function(t,e){t>this.frontier&&t-this.frontier<MAX_SCAN_DIST&&(t=this.frontier);var n=this.findIndex(t);return n<this.states.length&&this.states[n].pos==t&&n++,0==n?new CachedState(e.startState(),0):this.states[n-1].copy(e)},t.prototype.getState=function(t,e,n){var i=this.stateBefore(e,n),r=i.pos,o=i.state;if(r<e-MAX_SCAN_DIST?(r=e,o=n.startState()):this.lastDecorations&&r<this.lastDecorations.from&&this.lastDecorations.from<=e&&(this.lastDecorations=null),r<e){for(var s=new StringStreamCursor(t.doc,r,t.tabSize),a=s.next(),h=r,l=0,c=[];r<e;)a.eol()?(a=s.next(),r++,++l%50&&c.push(new CachedState(copyState(n,o),r))):(readToken(n,a,o),r+=a.pos-a.start,a.start=a.pos);this.storeStates(h,e,c)}return o},t.prototype.apply=function(e){if(0==e.changes.length)return this;for(var n=e.doc.lineAt(e.changes.changes.reduce(function(t,e){return Math.min(t,e.from)},1e9)).start,i=[],r=0,o=this.states;r<o.length;r++){var s=o[r],a=e.changes.mapPos(s.pos,-1,!0);a>0&&i.push(a==s.pos?s:new CachedState(s.state,a))}return new t(i,Math.min(n,this.frontier),cutDecoratedRange(this.lastDecorations,n))},t}();function legacyMode(t,e){void 0===e&&(e={});var n=e.sleepTime,i=void 0===n?100:n,r=e.maxWorkTime,o=void 0===r?100:r,s=new StateField({init:function(t){return new StateCache([],0,null)},apply:function(t,e){return e.apply(t)},debugName:"mode"}),a=new Plugin({state:s,view:function(e){var n=Decoration.none,r=-1,a=-1;function h(e,l){var c=e.viewport;if(l||c.from<r||c.to>a){r=c.from,a=c.to;var u=e.state.getField(s);n=Decoration.set(u.getDecorations(e.state,r,a,t)),u.advanceFrontier(e.state,r,t,i,o).then(function(){h(e,!0),e.decorationUpdate()},function(){})}}return{get decorations(){return n},updateViewport:h,updateState:function(t,e,n){return h(t,n.some(function(t){return t.docChanged}))}}}});return a.indentation=function(e,n){if(!t.indent)return-1;var i=e.getField(s).getState(e,n,t),r=e.doc.lineAt(n);return t.indent(i,r.slice(0,Math.min(r.length,100)).match(/^\s*(.*)/)[1])},a}function javascript(t,e){var n,i,r=t.indentUnit,o=e.statementIndent,s=e.jsonld,a=e.json||s,h=e.typescript,l=e.wordCharacters||/[\w$\xa1-\uffff]/,c=function(){function t(t){return{type:t,style:"keyword"}}var e=t("keyword a"),n=t("keyword b"),i=t("keyword c"),r=t("keyword d"),o=t("operator"),s={type:"atom",style:"atom"};return{if:t("if"),while:e,with:e,else:n,do:n,try:n,finally:n,return:r,break:r,continue:r,new:t("new"),delete:i,void:i,throw:i,debugger:t("debugger"),var:t("var"),const:t("var"),let:t("var"),function:t("function"),catch:t("catch"),for:t("for"),switch:t("switch"),case:t("case"),default:t("default"),in:o,typeof:o,instanceof:o,true:s,false:s,null:s,undefined:s,NaN:s,Infinity:s,this:t("this"),class:t("class"),super:t("atom"),yield:i,export:t("export"),import:t("import"),extends:i,await:i}}(),u=/[+\-*&%=<>!?|~^@]/,f=/^@(context|id|value|language|type|container|list|set|reverse|index|base|vocab|graph)"/;function d(t,e,r){return n=t,i=r,e}function p(t,e){var n,i=t.next();if('"'==i||"'"==i)return e.tokenize=(n=i,function(t,e){var i,r=!1;if(s&&"@"==t.peek()&&t.match(f))return e.tokenize=p,d("jsonld-keyword","meta");for(;null!=(i=t.next())&&(i!=n||r);)r=!r&&"\\"==i;return r||(e.tokenize=p),d("string","string")}),e.tokenize(t,e);if("."==i&&t.match(/^\d+(?:[eE][+\-]?\d+)?/))return d("number","number");if("."==i&&t.match(".."))return d("spread","meta");if(/[\[\]{}\(\),;\:\.]/.test(i))return d(i);if("="==i&&t.eat(">"))return d("=>","operator");if("0"==i&&t.eat(/x/i))return t.eatWhile(/[\da-f]/i),d("number","number");if("0"==i&&t.eat(/o/i))return t.eatWhile(/[0-7]/i),d("number","number");if("0"==i&&t.eat(/b/i))return t.eatWhile(/[01]/i),d("number","number");if(/\d/.test(i))return t.match(/^\d*(?:\.\d*)?(?:[eE][+\-]?\d+)?/),d("number","number");if("/"==i)return t.eat("*")?(e.tokenize=g,g(t,e)):t.eat("/")?(t.skipToEnd(),d("comment","comment")):Ft(t,e,1)?(function(t){for(var e,n=!1,i=!1;null!=(e=t.next());){if(!n){if("/"==e&&!i)return;"["==e?i=!0:i&&"]"==e&&(i=!1)}n=!n&&"\\"==e}}(t),t.match(/^\b(([gimyu])(?![gimyu]*\2))+\b/),d("regexp","string-2")):(t.eat("="),d("operator","operator",t.current()));if("`"==i)return e.tokenize=m,m(t,e);if("#"==i)return t.skipToEnd(),d("error","error");if(u.test(i))return">"==i&&e.lexical&&">"==e.lexical.type||(t.eat("=")?"!"!=i&&"="!=i||t.eat("="):/[<>*+\-]/.test(i)&&(t.eat(i),">"==i&&t.eat(i))),d("operator","operator",t.current());if(l.test(i)){t.eatWhile(l);var r=t.current();if("."!=e.lastType){if(c.propertyIsEnumerable(r)){var o=c[r];return d(o.type,o.style,r)}if("async"==r&&t.match(/^(\s|\/\*.*?\*\/)*[\(\w]/,!1))return d("async","keyword",r)}return d("variable","variable",r)}}function g(t,e){for(var n,i=!1;n=t.next();){if("/"==n&&i){e.tokenize=p;break}i="*"==n}return d("comment","comment")}function m(t,e){for(var n,i=!1;null!=(n=t.next());){if(!i&&("`"==n||"$"==n&&t.eat("{"))){e.tokenize=p;break}i=!i&&"\\"==n}return d("quasi","string-2",t.current())}var v="([{}])";function y(t,e){e.fatArrowAt&&(e.fatArrowAt=null);var n=t.string.indexOf("=>",t.start);if(!(n<0)){if(h){var i=/:\s*(?:\w+(?:<[^>]*>|\[\])?|\{[^}]*\})\s*$/.exec(t.string.slice(t.start,n));i&&(n=i.index)}for(var r=0,o=!1,s=n-1;s>=0;--s){var a=t.string.charAt(s),c=v.indexOf(a);if(c>=0&&c<3){if(!r){++s;break}if(0==--r){"("==a&&(o=!0);break}}else if(c>=3&&c<6)++r;else if(l.test(a))o=!0;else{if(/["'\/]/.test(a))return;if(o&&!r){++s;break}}}o&&!r&&(e.fatArrowAt=s)}}var w={atom:!0,number:!0,variable:!0,string:!0,regexp:!0,this:!0,"jsonld-keyword":!0};function b(t,e,n,i,r,o){this.indented=t,this.column=e,this.type=n,this.prev=r,this.info=o,null!=i&&(this.align=i)}function S(t,e){for(var n=t.localVars;n;n=n.next)if(n.name==e)return!0;for(var i=t.context;i;i=i.prev)for(n=i.vars;n;n=n.next)if(n.name==e)return!0}var x={state:null,column:null,marked:null,cc:null};function C(){for(var t=arguments.length-1;t>=0;t--)x.cc.push(arguments[t])}function M(){return C.apply(null,arguments),!0}function A(t){function n(e){for(var n=e;n;n=n.next)if(n.name==t)return!0;return!1}var i=x.state;if(x.marked="def",i.context){if(n(i.localVars))return;i.localVars={name:t,next:i.localVars}}else{if(n(i.globalVars))return;e.globalVars&&(i.globalVars={name:t,next:i.globalVars})}}function E(t){return"public"==t||"private"==t||"protected"==t||"abstract"==t||"readonly"==t}var k={name:"this",next:{name:"arguments"}};function D(){x.state.context={prev:x.state.context,vars:x.state.localVars},x.state.localVars=k}function T(){x.state.localVars=x.state.context.vars,x.state.context=x.state.context.prev}function L(t,e){var n=function(){var n=x.state,i=n.indented;if("stat"==n.lexical.type)i=n.lexical.indented;else for(var r=n.lexical;r&&")"==r.type&&r.align;r=r.prev)i=r.indented;n.lexical=new b(i,x.stream.column(),t,null,n.lexical,e)};return n.lex=!0,n}function P(){var t=x.state;t.lexical.prev&&(")"==t.lexical.type&&(t.indented=t.lexical.indented),t.lexical=t.lexical.prev)}function O(t){return function e(n){return n==t?M():";"==t?C():M(e)}}function R(t,e){return"var"==t?M(L("vardef",e.length),ft,O(";"),P):"keyword a"==t?M(L("form"),_,R,P):"keyword b"==t?M(L("form"),R,P):"keyword d"==t?x.stream.match(/^\s*$/,!1)?M():M(L("stat"),N,O(";"),P):"debugger"==t?M(O(";")):"{"==t?M(L("}"),tt,P):";"==t?M():"if"==t?("else"==x.state.lexical.info&&x.state.cc[x.state.cc.length-1]==P&&x.state.cc.pop()(),M(L("form"),_,R,P,vt)):"function"==t?M(Ct):"for"==t?M(L("form"),yt,R,P):"class"==t||h&&"interface"==e?(x.marked="keyword",M(L("form"),Et,P)):"variable"==t?h&&"declare"==e?(x.marked="keyword",M(R)):h&&("module"==e||"enum"==e||"type"==e)&&x.stream.match(/^\s*\w/,!1)?(x.marked="keyword","enum"==e?M(Nt):"type"==e?M(rt,O("operator"),rt,O(";")):M(L("form"),dt,O("{"),L("}"),tt,P,P)):h&&"namespace"==e?(x.marked="keyword",M(L("form"),V,tt,P)):h&&"abstract"==e?(x.marked="keyword",M(R)):M(L("stat"),K):"switch"==t?M(L("form"),_,O("{"),L("}","switch"),tt,P,P):"case"==t?M(V,O(":")):"default"==t?M(O(":")):"catch"==t?M(L("form"),D,O("("),Mt,O(")"),R,P,T):"export"==t?M(L("stat"),Lt,P):"import"==t?M(L("stat"),Ot,P):"async"==t?M(R):"@"==e?M(V,R):C(L("stat"),V,O(";"),P)}function V(t,e){return B(t,e,!1)}function I(t,e){return B(t,e,!0)}function _(t){return"("!=t?C():M(L(")"),V,O(")"),P)}function B(t,e,n){if(x.state.fatArrowAt==x.stream.start){var i=n?G:W;if("("==t)return M(D,L(")"),Y(Mt,")"),P,O("=>"),i,T);if("variable"==t)return C(D,dt,O("=>"),i,T)}var r=n?F:H;return w.hasOwnProperty(t)?M(r):"function"==t?M(Ct,r):"class"==t||h&&"interface"==e?(x.marked="keyword",M(L("form"),At,P)):"keyword c"==t||"async"==t?M(n?I:V):"("==t?M(L(")"),N,O(")"),P,r):"operator"==t||"spread"==t?M(n?I:V):"["==t?M(L("]"),Bt,P,r):"{"==t?J(X,"}",null,r):"quasi"==t?C(z,r):"new"==t?M(function(t){return function(e){return"."==e?M(t?$:q):"variable"==e&&h?M(lt,t?F:H):C(t?I:V)}}(n)):"import"==t?M(V):M()}function N(t){return t.match(/[;\}\)\],]/)?C():C(V)}function H(t,e){return","==t?M(V):F(t,e,!1)}function F(t,e,n){var i=0==n?H:F,r=0==n?V:I;return"=>"==t?M(D,n?G:W,T):"operator"==t?/\+\+|--/.test(e)||h&&"!"==e?M(i):h&&"<"==e&&x.stream.match(/^([^>]|<.*?>)*>\s*\(/,!1)?M(L(">"),Y(rt,">"),P,i):"?"==e?M(V,O(":"),r):M(r):"quasi"==t?C(z,i):";"!=t?"("==t?J(I,")","call",i):"."==t?M(U,i):"["==t?M(L("]"),N,O("]"),P,i):h&&"as"==e?(x.marked="keyword",M(rt,i)):"regexp"==t?(x.state.lastType=x.marked="operator",x.stream.backUp(x.stream.pos-x.stream.start-1),M(r)):void 0:void 0}function z(t,e){return"quasi"!=t?C():"${"!=e.slice(e.length-2)?M(z):M(V,j)}function j(t){if("}"==t)return x.marked="string-2",x.state.tokenize=m,M(z)}function W(t){return y(x.stream,x.state),C("{"==t?R:V)}function G(t){return y(x.stream,x.state),C("{"==t?R:I)}function q(t,e){if("target"==e)return x.marked="keyword",M(H)}function $(t,e){if("target"==e)return x.marked="keyword",M(F)}function K(t){return":"==t?M(P,R):C(H,O(";"),P)}function U(t){if("variable"==t)return x.marked="property",M()}function X(t,e){return"async"==t?(x.marked="property",M(X)):"variable"==t||"keyword"==x.style?(x.marked="property","get"==e||"set"==e?M(Q):(h&&x.state.fatArrowAt==x.stream.start&&(n=x.stream.match(/^\s*:\s*/,!1))&&(x.state.fatArrowAt=x.stream.pos+n[0].length),M(Z))):"number"==t||"string"==t?(x.marked=s?"property":x.style+" property",M(Z)):"jsonld-keyword"==t?M(Z):h&&E(e)?(x.marked="keyword",M(X)):"["==t?M(V,et,O("]"),Z):"spread"==t?M(I,Z):"*"==e?(x.marked="keyword",M(X)):":"==t?C(Z):void 0;var n}function Q(t){return"variable"!=t?C(Z):(x.marked="property",M(Ct))}function Z(t){return":"==t?M(I):"("==t?C(Ct):void 0}function Y(t,e,n){function i(r,o){if(n?n.indexOf(r)>-1:","==r){var s=x.state.lexical;return"call"==s.info&&(s.pos=(s.pos||0)+1),M(function(n,i){return n==e||i==e?C():C(t)},i)}return r==e||o==e?M():M(O(e))}return function(n,r){return n==e||r==e?M():C(t,i)}}function J(t,e,n){for(var i=3;i<arguments.length;i++)x.cc.push(arguments[i]);return M(L(e,n),Y(t,e),P)}function tt(t){return"}"==t?M():C(R,tt)}function et(t,e){if(h){if(":"==t)return M(rt);if("?"==e)return M(et)}}function nt(t){if(h&&":"==t)return x.stream.match(/^\s*\w+\s+is\b/,!1)?M(V,it,rt):M(rt)}function it(t,e){if("is"==e)return x.marked="keyword",M()}function rt(t,e){return"keyof"==e||"typeof"==e?(x.marked="keyword",M("keyof"==e?rt:I)):"variable"==t||"void"==e?(x.marked="type",M(ht)):"string"==t||"number"==t||"atom"==t?M(ht):"["==t?M(L("]"),Y(rt,"]",","),P,ht):"{"==t?M(L("}"),Y(st,"}",",;"),P,ht):"("==t?M(Y(at,")"),ot):"<"==t?M(Y(rt,">"),rt):void 0}function ot(t){if("=>"==t)return M(rt)}function st(t,e){return"variable"==t||"keyword"==x.style?(x.marked="property",M(st)):"?"==e?M(st):":"==t?M(rt):"["==t?M(V,et,O("]"),st):void 0}function at(t,e){return"variable"==t&&x.stream.match(/^\s*[?:]/,!1)||"?"==e?M(at):":"==t?M(rt):C(rt)}function ht(t,e){return"<"==e?M(L(">"),Y(rt,">"),P,ht):"|"==e||"."==t||"&"==e?M(rt):"["==t?M(O("]"),ht):"extends"==e||"implements"==e?(x.marked="keyword",M(rt)):void 0}function lt(t,e){if("<"==e)return M(L(">"),Y(rt,">"),P,ht)}function ct(){return C(rt,ut)}function ut(t,e){if("="==e)return M(rt)}function ft(t,e){return"enum"==e?(x.marked="keyword",M(Nt)):C(dt,et,gt,mt)}function dt(t,e){return h&&E(e)?(x.marked="keyword",M(dt)):"variable"==t?(A(e),M()):"spread"==t?M(dt):"["==t?J(dt,"]"):"{"==t?J(pt,"}"):void 0}function pt(t,e){return"variable"!=t||x.stream.match(/^\s*:/,!1)?("variable"==t&&(x.marked="property"),"spread"==t?M(dt):"}"==t?C():M(O(":"),dt,gt)):(A(e),M(gt))}function gt(t,e){if("="==e)return M(I)}function mt(t){if(","==t)return M(ft)}function vt(t,e){if("keyword b"==t&&"else"==e)return M(L("form","else"),R,P)}function yt(t,e){return"await"==e?M(yt):"("==t?M(L(")"),wt,O(")"),P):void 0}function wt(t){return"var"==t?M(ft,O(";"),St):";"==t?M(St):"variable"==t?M(bt):C(V,O(";"),St)}function bt(t,e){return"in"==e||"of"==e?(x.marked="keyword",M(V)):M(H,St)}function St(t,e){return";"==t?M(xt):"in"==e||"of"==e?(x.marked="keyword",M(V)):C(V,O(";"),xt)}function xt(t){")"!=t&&M(V)}function Ct(t,e){return"*"==e?(x.marked="keyword",M(Ct)):"variable"==t?(A(e),M(Ct)):"("==t?M(D,L(")"),Y(Mt,")"),P,nt,R,T):h&&"<"==e?M(L(">"),Y(ct,">"),P,Ct):void 0}function Mt(t,e){return"@"==e&&M(V,Mt),"spread"==t?M(Mt):h&&E(e)?(x.marked="keyword",M(Mt)):C(dt,et,gt)}function At(t,e){return"variable"==t?Et(t,e):kt(t,e)}function Et(t,e){if("variable"==t)return A(e),M(kt)}function kt(t,e){return"<"==e?M(L(">"),Y(ct,">"),P,kt):"extends"==e||"implements"==e||h&&","==t?("implements"==e&&(x.marked="keyword"),M(h?rt:V,kt)):"{"==t?M(L("}"),Dt,P):void 0}function Dt(t,e){return"async"==t||"variable"==t&&("static"==e||"get"==e||"set"==e||h&&E(e))&&x.stream.match(/^\s+[\w$\xa1-\uffff]/,!1)?(x.marked="keyword",M(Dt)):"variable"==t||"keyword"==x.style?(x.marked="property",M(h?Tt:Ct,Dt)):"["==t?M(V,et,O("]"),h?Tt:Ct,Dt):"*"==e?(x.marked="keyword",M(Dt)):";"==t?M(Dt):"}"==t?M():"@"==e?M(V,Dt):void 0}function Tt(t,e){return"?"==e?M(Tt):":"==t?M(rt,gt):"="==e?M(I):C(Ct)}function Lt(t,e){return"*"==e?(x.marked="keyword",M(_t,O(";"))):"default"==e?(x.marked="keyword",M(V,O(";"))):"{"==t?M(Y(Pt,"}"),_t,O(";")):C(R)}function Pt(t,e){return"as"==e?(x.marked="keyword",M(O("variable"))):"variable"==t?C(I,Pt):void 0}function Ot(t){return"string"==t?M():"("==t?C(V):C(Rt,Vt,_t)}function Rt(t,e){return"{"==t?J(Rt,"}"):("variable"==t&&A(e),"*"==e&&(x.marked="keyword"),M(It))}function Vt(t){if(","==t)return M(Rt,Vt)}function It(t,e){if("as"==e)return x.marked="keyword",M(Rt)}function _t(t,e){if("from"==e)return x.marked="keyword",M(V)}function Bt(t){return"]"==t?M():C(Y(I,"]"))}function Nt(){return C(L("form"),dt,O("{"),L("}"),Y(Ht,"}"),P,P)}function Ht(){return C(dt,gt)}function Ft(t,e,n){return e.tokenize==p&&/^(?:operator|sof|keyword [bcd]|case|new|export|default|spread|[\[{}\(,;:]|=>)$/.test(e.lastType)||"quasi"==e.lastType&&/\{\s*$/.test(t.string.slice(0,t.pos-(n||0)))}return P.lex=!0,{startState:function(t){var n={tokenize:p,lastType:"sof",cc:[],lexical:new b((t||0)-r,0,"block",!1),localVars:e.localVars,context:e.localVars&&{vars:e.localVars},indented:t||0};return e.globalVars&&"object"==typeof e.globalVars&&(n.globalVars=e.globalVars),n},token:function(t,e){if(t.sol()&&(e.lexical.hasOwnProperty("align")||(e.lexical.align=!1),e.indented=t.indentation(),y(t,e)),e.tokenize!=g&&t.eatSpace())return null;var r=e.tokenize(t,e);return"comment"==n?r:(e.lastType="operator"!=n||"++"!=i&&"--"!=i?n:"incdec",function(t,e,n,i,r){var o=t.cc;for(x.state=t,x.stream=r,x.marked=null,x.cc=o,x.style=e,t.lexical.hasOwnProperty("align")||(t.lexical.align=!0);;)if((o.length?o.pop():a?V:R)(n,i)){for(;o.length&&o[o.length-1].lex;)o.pop()();return x.marked?x.marked:"variable"==n&&S(t,i)?"variable-2":e}}(e,r,n,i,t))},indent:function(t,n){if(t.tokenize==g)return-1;if(t.tokenize!=p)return 0;var i,s=n&&n.charAt(0),a=t.lexical;if(!/^\s*else\b/.test(n))for(var h=t.cc.length-1;h>=0;--h){var l=t.cc[h];if(l==P)a=a.prev;else if(l!=vt)break}for(;("stat"==a.type||"form"==a.type)&&("}"==s||(i=t.cc[t.cc.length-1])&&(i==H||i==F)&&!/^[,\.=+\-*:?[\(]/.test(n));)a=a.prev;o&&")"==a.type&&"stat"==a.prev.type&&(a=a.prev);var c=a.type,f=s==c;return"vardef"==c?a.indented+("operator"==t.lastType||","==t.lastType?a.info+1:0):"form"==c&&"{"==s?a.indented:"form"==c?a.indented+r:"stat"==c?a.indented+(function(t,e){return"operator"==t.lastType||","==t.lastType||u.test(e.charAt(0))||/[,.]/.test(e.charAt(0))}(t,n)?o||r:0):"switch"!=a.info||f||0==e.doubleIndentSwitch?a.align?a.column+(f?0:1):a.indented+(f?0:r):a.indented+(/^(?:case|default)\b/.test(n)?r:2*r)},electricInput:/^\s*(?:case .*?:|default:|\{|\})$/,blockCommentStart:a?null:"/*",blockCommentEnd:a?null:"*/",blockCommentContinue:a?null:" * ",lineComment:a?null:"//",fold:"brace",closeBrackets:"()[]{}''\"\"``",helperType:a?"json":"javascript",jsonldMode:s,jsonMode:a,expressionAllowed:Ft,skipExpression:function(t){var e=t.cc[t.cc.length-1];e!=V&&e!=I||t.cc.pop()}}}exports.javascript=javascript,exports.EditorSelection=EditorSelection,exports.Plugin=Plugin,exports.StateField=StateField,exports.EditorState=EditorState,exports.Transaction=Transaction,exports.Change=Change,exports.EditorView=EditorView,exports.keymap=keymap,exports.history=history,exports.redo=redo,exports.redoSelection=redoSelection,exports.undo=undo,exports.undoSelection=undoSelection,exports.gutter=gutter,exports.baseKeymap=baseKeymap,exports.matchBrackets=matchBrackets,exports.specialChars=specialChars,exports.multipleSelections=multipleSelections,exports.legacyMode=legacyMode;
//# sourceMappingURL=/sm/e77ded553c12c2dede2b2267f75c2b144b1f64f6e2fa71ac4e17cca59426c668.map